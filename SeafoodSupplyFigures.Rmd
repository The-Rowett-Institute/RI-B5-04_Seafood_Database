---
title: "Part 3. UK seafood supplies"
author: "AL"
date: "2023-03-10"
output: powerpoint_presentation
---

### Preparation 

```{r Load libraries, include = FALSE}
# Load packages
library(tidyr) # for tidying data
library(dplyr) # base R alternative but neater
library(vroom) # for loading and transforming data
library(tidyverse) # data exploration 
library(reshape2) # for melting data frames i.e. short and wide to long and thin
library(data.table) # for fread()-function
library(mice) # md.pattern to show missing data
library(plyr) # joins multiple data frames together
library(ggplot2)
library(scales) # displays integers on the axis
library(ggthemes)

```


```{r Edit chunk settings, include = FALSE}
knitr::opts_chunk$set(
  echo = FALSE, 
  message = FALSE, 
  warninf = FALSE, 
  fig.height = 9, 
  fig.width = 16
)
```


```{r Setup default for figures, include=FALSE}
# Set default presentation of figures
theme_set(theme_bw()%+replace%
            theme(
              title = element_text(size = 26), 
              text = element_text(size = 26), 
              axis.text = element_text(size = 24, colour = "gray40"), 
              legend.key.size = unit(1.2, "cm"), 
              legend.title = element_text(size = 26), 
              legend.text = element_text(size = 24),
              panel.grid.major = element_line(colour= "gray40", linetype = "dotted", linewidth = 0.7), 
              panel.grid.minor = element_line(colour = "gray70", linetype = "dotted", linewidth = 0.7)
            ))
# instead of "size" can also use "linewidth"
```


```{r Set colour-blind palette}
# Colour-blind friendly palette with grey. Try to keep the order (http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/#a-colorblind-friendly-palette)
cbPalette <- c( "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "#999999")

# Colours will be allocated in commodity alphabetical order. 
```


```{r Load file path, echo=TRUE}
# Loading file path to the data into a value 
source("Data_filepath.R")# Data_filepath.R is listed in .gitignore-file. So, you will need to create that file yourself and provide your respected filepath using "data_dir <- [enter your here]"
```


```{r Specify the desired file path}
filepath <- paste(data_dir,"Outputs", sep = "") 
# note we are able to change this to another file e.g. saving the output
```


```{r Load the database}
# Load database 
df_UK_seafoodDB <- vroom(file=paste(filepath,"Seafood-database_preliminary.csv", sep="/"), na = c("NA"))
```


Remove products for non-human consumption nor are included in the dietary recommendations 

```{r Final clean}
# Check the unique species types
unique(df_UK_seafoodDB$SpeciesType)

# Remove species type products not included in dietary recommendations e.g. "Fish meal", "white fish", "fish oil", "Seaweed and other algae". Remove products for non-human consumption. Remove 2019 data
df_UK_seafoodDB_food <- subset(df_UK_seafoodDB, SpeciesType != "Fish oil" & SpeciesType != "Seaweed and other algae" & Species != "Fishmeal" & Species != "Caviar, livers and roes" & Species != "White fish" & Species != "Surimi" & Year != 2019)

str(df_UK_seafoodDB_food)
colnames(df_UK_seafoodDB_food)

```


```{r Change structure of the data frame}
# See pivot_wider()/ spread() command in tidyverse to change structure. 
# See dplyr cheat sheet.

# Simplify data set and select desired columns 
df_UK_seafoodDB_food_spec <- df_UK_seafoodDB_food[c("Species", "SpeciesType", "SACN", "Year", "Commodity", "Value" )]

# Aggregate value by commodity, year and species (production data composed of aquaculture and wild capture)
df_UK_seafoodDB_food_simp <- aggregate(Value ~ Commodity + Year + Species + SpeciesType + SACN, data = df_UK_seafoodDB_food_spec, sum)

# Make data frame wide and short
df_UK_seafoodDB_short <- df_UK_seafoodDB_food_simp %>%
  pivot_wider(names_from = Commodity, values_from = Value)
```


```{r Calculate seafood supplies}
# Convert NA to zeros (otherwise supplies cannot be calculated)
df_UK_seafoodDB_short[is.na(df_UK_seafoodDB_short)] <- 0

# Calculate seafood supplies
df_UK_seafoodDB_short$Supplies <- (df_UK_seafoodDB_short$Production + df_UK_seafoodDB_short$Imports) - df_UK_seafoodDB_short$Exports
```


```{r Calculate seafood supplies (g/capita/week)}
# Merge data frame with UK population data 
df_UK_seafoodDB_short$Pop <- merge(df_UK_seafoodDB_short, UKpop, by = "Year")

# Calculate seafood supplies per capita
df_UK_seafoodDB_short$Supplies_capWeek <- df_UK_seafoodDB_short$Supplies 

# Calculate seafood supplies
df_UK_seafoodDB_short$Supplies <- (df_UK_seafoodDB_short$Production + df_UK_seafoodDB_short$Imports) - df_UK_seafoodDB_short$Exports
```



### Creating figures in ggplot

### Figure 1. Barchart of seafood database commodities 

### Figure 2. Average UK seafood supply (g/capita/week) between 2009 and 2018  

```{r}
# Plot using ggplot
ggplot(df_UK_seafoodDB_short, aes(Year, Supplies)) +
  geom_point() +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") + 
  scale_y_continuous(name = "Seafood supplies (g)") +
  geom_hline(yintercept = 0, linetype="dashed", color = "red", linewidth = 1.0)


```


```{r Set y axis scale to log}



# set the y axis scale to logorithmic. Allows us to explore the points cloassly aggregated to 0 and those at significantly higher values.
```


```{r}
# Set "colour" to black. Colour changes the outline of the bars, whilst "fill" changes the inside colour of the bars. 

```


### Figure 3. Comparing seafood supplies (g/capita/week) with dietary recommendations in the UK and Scotland 

```{r}
# Ensure y-axis values are on the same scale
# Able to use facetwrap() and change the title of the strip
```



### Figure 4. Caluculaing seafood wastage in the UK between 2009 and 2018. 


