
---
title: "Data cleaning. RI-B5-04: UK seafood supply chains"
author: "A.Lofstedt, B.Scheliga"
date: '16/09/2022'
output: html_document
---

```{r setup, include=FALSE}
# sets options for entire document in the first chunk
knitr::opts_chunk$set(echo = TRUE)
```

## Part 1: Identifying and cleaning data to map seafood supply chains in the UK 

This R Markdown document (part 1) outlines how the data complied in the final spreadsheet mapping UK seafood supply chains was cleaned. 

The justification for the data included in this data set can be found in the supporting excel document.  

## Preparation

```{r Load libraries, include=FALSE}
library(tidyr)
library(vroom) # for loading and transforming data
library(tidyverse)

```

```{r Load data, echo=TRUE}
# Loading file path to the data into a value 
source("Data_filepath.R")# Data_filepath.R is listed in .gitignore-file. So, you will need to create that file yourself and provide your respected filepath using "data_dir <- [enter your here]"
```

```{r Specify the desired file path}
filepath <- paste(data_dir,"RawData/csv-files", sep="") 
# note we are able to change this to another file e.g. saving the output

```

## Production

UK fish production data includes capture fisheries and aquaculture production 

### A) Capture fisheries (Office of National Statistics)

```{r Load data (2011 to 2020)}
# i) Landings into the UK by UK vessels: 2011 to 2020 (a)
# extract UK landings data between 2011 and 2020.

# Read in landing data
df_UK_landings_11_20_data <- vroom(file=paste(filepath,"NS_UK_landings-201120-edit.csv", sep="/"), na = c(".."))

```

```{r Transform and clean dataset (2011 to 2020)}
# Change structure of the dataset 
# Reshape2


```


```{r Load data (2009 to 2010)}
# ii) Landings into the UK by UK vessels: 2008 to 2012 (b)
# Extract UK landings data between 2009 and 2010. 

# Read in landing data
df_UK_landings_08_12_data <- vroom(file=paste(filepath,"NS_UK_landings-200812-edit.csv", sep="/"),na = c(".."))

# Select only years 2009 and 2010
df_UK_landings_09_10 <- subset(df_UK_landings_08_12_data, 
                           select = c('Species_type', 'Species', '2009', '2010'))

```


```{r Transform and clean dataset (2009 to 2010)}
# Change structure of the dataset 
#reshape2
```


```{r Combine datasets (2009 to 2010 and 2011 to 2020)}
# Combine capture production data sets (2009 to 2010 and 2011 to 2020)
df_clean_UK_landings_09_20 <- merge(df_UK_landings_11_20_data, df_UK_landings_09_10)

```

```{r Add additional variables to combined data}
# Create "cleaned" data frame, defining units and data source 
df_clean_UK_landings_09_20$Units <- "000-tonnes"
df_clean_UK_landings_09_20$DataSource <- "National-statistics"
df_clean_UK_landings_09_20$Dataset <- "UK-sea-fisheries-statistics"
df_clean_UK_landings_09_20$Commodity <- "Production"
df_clean_UK_landings_09_20$TempRes <- "Annual"
```


```{r Save cleaned data}
# Change file path to "ProcessedData"
#filepath <- paste(data_dir,"ProcessedData/csv-files", sep="") 
#NS_UK_capture_cleaned <- write.csv(df_clean_UK_landings_09_20)

```

### B) Aquaculture production (Marine Scotland and DEFRA)

```{r Load data (Scotland: Marine Scotland Science)}
# a) Aquaculture production in Scotland
# i) salmon, ii) rainbow trout, iii) shellfish
df_MSS_salmon_data <- vroom(file=paste(filepath,"MSS_Scotland_aquacultureSalmon.csv", sep="/"), na = c(".."))

df_MSS_rainbowTrout_data <- vroom(file=paste(filepath,"MSS_Scotland_aquacultureRainbowTrout.csv", sep="/"), na = c(".."))

df_MSS_shellfish_data <- vroom(file=paste(filepath,"MSS_Scotland_aquacultureShellfish.csv", sep="/"), na = c(".."))

```

```{r Subset data (Scotland: Marine Scotland Science)}
# Determine products are for human consumption 
df_MSS_shellfish_HC <- subset(df_MSS_shellfish_data, Production == "For the table")

# Subset data between 2009 and 2021 
df_MSS_salmon <- subset(df_MSS_salmon_data, Year > 2008, 
                        select= c(Year, Tonnes)) 

df_MSS_rainbowTrout <- subset(df_MSS_rainbowTrout_data, Year > 2008, 
                        select= c("Year", "Total Tonnes"))

df_MSS_shellfish <- subset(df_MSS_shellfish_HC, Year > 2008)

# State species, unit and data source
df_MSS_salmon$Units <- "tonnes"
df_MSS_salmon$Species <- "Salmon"
df_MSS_salmon$SpeciesType <- "Diadromous"

df_MSS_rainbowTrout$Units <- "tonnes"
df_MSS_rainbowTrout$Species <- "RainbowTrout"
df_MSS_rainbowTrout$SpeciesType <- "Freshwater"

df_MSS_shellfish$Units <- "Varied"
df_MSS_shellfish$Species <- "Varied"
df_MSS_rainbowTrout$SpeciesType <- "Shellfish"

```

```{r Combine Scottish aqacualture production data}

#df_MMS_production<- merge(df_MSS_salmon, df_MSS_rainbowTrout)

```


```{r Add units and data source (Scotland: Marine Scotland Science)}
# Create "cleaned" data frame, defining units and data source 

#df_clean_UK_landings_09_20$Units <- "tonnes or numbers"
df_MMS_production$DataSource <- "Marine_Scotland"
df_MMS_production$Dataset <- "Scottish-aquaculture"
df_MMS_production$Commodity <- "Production"
df_MMS_production$TempRes <- "Annual"
```

```{r Save cleaned data (Scotland: Marine Scotland Science)}

```

## Note: include EU data? Been in contact with CEFAS

## Trade (HMRC)

```{r Load data}

```


## UK fish consumption (NDNS)

```{r Load data}
# Read in NDNS data
df_NDNS_UK_data <- vroom(file=paste
                      (filepath,"NDNS_UK_consumption-edit.csv", sep="/"))

```

```{r Aggregate cohort information}
# Identify unique age cohorts
unique(df_NDNS_UK_data$`Age category`)

# Create a pipe aggregating sub age cohort totals, irrespective of sex 
all_sex <- df_NDNS_UK_data[df_NDNS_UK_data$`Age category` %in% c("Children 1.5-3 years", "Children 4-10 years", "Children 11-18 years", "Adults 19-64 years", "Adults 65 years and over"), ]

# Sum all subsetted cohorts 
df_clean_NDNS <- as.data.frame(colSums(all_sex[3:7])) 

# Rename first column  

```

```{r Add units and data source}
# Create "cleaned" data frame, defining units and data source 
df_clean_NDNS$Units <- "g/capita/day"
df_clean_NDNS$DataSource <- "NDNS"
df_clean_NDNS$Dataset <- "NDNS"
df_clean_NDNS$Commodity <- "Consumption"
df_clean_NDNS$TempRes <- "Biennial"
df_clean_NDNS$FishSpecies <- "Unknown"


```


```{r Save cleaned data}

```


## UK fish purchasing data (DEFRA and Kantar)

### A) DEFRA family food data sets

#### i) DEFRA UK purchases (both household and eating out)

```{r Load data 2015 to 2020} 
# Data not separated for household and eating out purposes from 2015 onwards

# Separate location of fish consumption: i.e. household/ eating out

```


#### i) Household purchases (DEFRA)

```{r Load data (2009 to 2014)}
# read DEFRA household dataset (.csv)
df_DEFRA_household_data <- vroom(file=paste(filepath,"DEFRA_UK_household-200914-edit.csv", sep="/"))

```


```{r Aggregate food groups}
# Identify unique major food groups
unique(df_DEFRA_household_data$`Major Food Code`)

# Major food codes according to FAO groupings
df_DEFRA_household_data$FAO <- "Unknown"
df_DEFRA_household_data$FAO[df_DEFRA_household_data$`Major Food Code` == "White fish, fresh, chilled or frozen"] <- "Demersal"
df_DEFRA_household_data$FAO[df_DEFRA_household_data$`Major Food Code` == "White fish, dried, salted or smoked"] <- "Demersal"
df_DEFRA_household_data$FAO[df_DEFRA_household_data$`Major Food Code` == "Shellfish"] <- "Shellfish"
df_DEFRA_household_data$FAO[df_DEFRA_household_data$`Major Food Code` == "Herrings and other blue fish, fresh, chilled or frozen"] <-"Pelagic"
df_DEFRA_household_data$FAO[df_DEFRA_household_data$`Major Food Code` == "Salmon, fresh, chilled or frozen"] <- "Pelagic"
df_DEFRA_household_data$FAO[df_DEFRA_household_data$`Major Food Code` == "Blue fish, dried or salted or smoked"] <- "Pelagic"
df_DEFRA_household_data$FAO[df_DEFRA_household_data$`Major Food Code` == "Salmon, tinned"] <- "Pelagic"
```


```{r Add units and data source}
# Create "cleaned" data frame, defining units and data source 
df_DEFRA_household_data$Units <- "g/capita/week"
df_DEFRA_household_data$Data_source <- "DEFRA-FF"

```


```{r Reshape cleaned data}

# reshape
```


```{r Save cleaned data}

```


#### ii) Eating out (DEFRA)

```{r Load data (2009 to 2014)}
# read DEFRA eaten out data set
df_DEFRA_eaten_out_data <- vroom(file=paste(filepath,"DEFRA_UK_eatenOut-200914-edit.csv", sep="/"))

```


```{r Aggregate food groups}

# Identify unique major food groups
unique(df_DEFRA_eaten_out_data$`EO Major code`)

# Major food codes according to FAO groupings.
df_DEFRA_eaten_out_data$FAO <- "Unknown"
df_DEFRA_eaten_out_data$FAO[df_DEFRA_eaten_out_data$EO.Major.code == "White fish"] <- "Demersal"
df_DEFRA_eaten_out_data$FAO[df_DEFRA_eaten_out_data$EO.Major.code == "Shellfish - without sauce or dressing (e.g. prawns, shrimps, oysters, crab)"] <- "Shellfish"
df_DEFRA_eaten_out_data$FAO[df_DEFRA_eaten_out_data$EO.Major.code == "Fatty fish"] <- "Pelagic"
df_DEFRA_eaten_out_data$FAO[df_DEFRA_eaten_out_data$EO.Major.code == "Kippers and other smoked fish (e.g. smoked salmon)"] <- "Pelagic"

```


```{r Add units and data source}
# Create "cleaned" data frame, defining units and data source
df_clean_DEFRA_eaten_out <- df_DEFRA_eaten_out_data
df_clean_DEFRA_eaten_out$Units <- "g/capita/week"
df_clean_DEFRA_eaten_out$Data_source <- "DEFRA-FF"

```

```{r Save cleaned data}

```


### B) Kantar 


## UK population data (Office of National Statistics)

Download UK population data- need to convert per g/capita data to g/total UK total population.

```{r Load data}
# Read in UK population data 
df_NS_UK_pop_data <- vroom(file=paste(filepath,"NS_UK_population-edit.csv", sep="/"))
```

```{r Subset data}
# Extract UK population data between 2009 onwards
df_UK_pop <- subset(df_NS_UK_pop_data, 
                      CDID > 2008, select= c(CDID, UKPOP))

```

```{r Add units and data source}
# Create "cleaned" data frame, defining units and data source 
df_clean_UK_pop <- df_UK_pop
df_clean_UK_pop$Units <- "UK-total-pop"
df_clean_UK_pop$Data_source <- "National-statistics"
```

```{r Save cleaned data}

```

