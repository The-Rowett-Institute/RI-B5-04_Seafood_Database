
---
title: "Data cleaning. RI-B5-04: UK seafood supply chains"
author: "A.Lofstedt, B.Scheliga"
date: '26/08/2022'
output: html_document
---

```{r setup, include=FALSE}
# sets options for entire document in the first chunk
knitr::opts_chunk$set(echo = TRUE)
```

## Part 1: Identifying and cleaning data to map seafood supply chains in the UK 

This R Markdown document (part 1) outlines how the data complied in the final spreadsheet mapping UK seafood supply chains was cleaned. 

The justification for the data included in this data set can be found in the supporting excel document.  

## Preparation

```{r Load libraries, include=FALSE}
library(tidyr)
library(vroom) # for loading and transforming data

```

```{r Load data, echo=TRUE}
# Loading file path to the data into a value 
source("Data_filepath.R")# Data_filepath.R is listed in .gitignore-file. So, you will need to create that file yourself and provide your respected filepath using "data_dir <- [enter your here]"
```

```{r Specify the desired file path}
filepath <- paste(data_dir,"RawData/csv-files", sep="") 
# note we are able to change this to another file e.g. saving the output

```

## Production

UK fish production data includes capture fisheries and aquaculture production 

### A) Capture fisheries (Office of National Statistics)

```{r Load data (2011 to 2020)}
# UK sea fisheries statistics
# Data source: Office of National Statistics

# i) Landings into the UK by UK vessels: 2011 to 2020 (a)
# extract UK landings data between 2011 and 2020 

# Read in landing data. Change file for each chunk 
df_UK_landings_11_20_data<- vroom(file=paste(filepath,"NS_UK-landings-11-20-edit.csv", sep="/"))

```

```{r Add units and data source (2011 to 2020) }
# Add in column expressing units and data source
df_UK_landings_11_20_data$Units<- "000 tonnes"
df_UK_landings_11_20_data$Data_source<- "National-statistics"
```

```{r Load data (2009 to 2010)}

# ii) Landings into the UK by UK vessels: 2008 to 2012 (b)
# Extract UK landings data between 2009 and 2010. 

# Read in landing data. 

df_UK_landings_08_12_data<- vroom(file=paste(filepath,"NS_UK-landings-08-12-edit.csv", sep="/"))
str(df_UK_landings_08_12_data)
colnames(df_UK_landings_08_12_data)

# Select only years 2009 and 2010
df_UK_landings_09_10<- subset(df_UK_landings_08_12_data, 
                           select = c(Species_type,Species,2009,2010))

```

```{r Add units and data source (2009 to 2010)}
# Add in column expressing units
df_UK_landings_09_10$Units<- "000 tonnes"
df_UK_landings_09_10$Data_source<- "National-statistics"
```

### B) Aquaculture production (Marine Scotland and DEFRA)

```{r Load data}
# Aquaculture production 
# Data source: Marine Scotland and DEFRA

```

```{r Add units and data source}

```


## Imports (HMRC)

## Exports (HMRC)

## UK fish consumption (NDNS)

```{r Load data}
# Read in NDNS data
NDNS_data<- vroom(file=paste(filepath,"NDNS_edit.csv", sep="/"))

str(NDNS_data)
```


```{r}
## Aggregate all age cohorts together
```

```{r Add units and data source}
# Units in g/person
```


## UK fish purchasing data (DEFRA and Kantar)

### A) DEFRA family food data sets

#### i) Household purchases

```{r echo=TRUE}
# read DEFRA household dataset (.csv)
DEFRA_household_data<- read.csv(file= paste(data_dir,"DEFRA.UK_households_edit.csv", sep="/"), header = T)

str(DEFRA_household_data)
unique(DEFRA_household_data$Major.Food.Code)
```


```{r Aggregate food groups}
# Major food codes according to FAO groupings
DEFRA_household_data$FAO<- "Unknown"
DEFRA_household_data$FAO[DEFRA_household_data$Major.Food.Code == "White fish, fresh, chilled or frozen"]<- "Demersal"
DEFRA_household_data$FAO[DEFRA_household_data$Major.Food.Code == "White fish, dried, salted or smoked"]<- "Demersal"
DEFRA_household_data$FAO[DEFRA_household_data$Major.Food.Code == "Shellfish"]<- "Shellfish"
DEFRA_household_data$FAO[DEFRA_household_data$Major.Food.Code == "Herrings and other blue fish, fresh, chilled or frozen"] <-"Pelagic"
DEFRA_household_data$FAO[DEFRA_household_data$Major.Food.Code == "Salmon, fresh, chilled or frozen"]<- "Pelagic"
DEFRA_household_data$FAO[DEFRA_household_data$Major.Food.Code == "Blue fish, dried or salted or smoked"]<- "Pelagic"
DEFRA_household_data$FAO[DEFRA_household_data$Major.Food.Code == "Salmon, tinned"]<- "Pelagic"
```


```{r Add units and data source}
# Units in g/person/week**

```

#### ii) Eating out

```{r Load data}
# read DEFRA eaten out dataset (.csv)
DEFRA_eaten_out_data<- read.csv(file= paste(data_dir,"DEFRA.UK_eaten_out_edit.csv", sep="/"), header = T)

str(DEFRA_eaten_out_data)
unique(DEFRA_eaten_out_data$EO.Major.code)
```


```{r Aggregate food groups}
# Major food codes according to FAO groupings.
DEFRA_eaten_out_data$FAO<- "Unknown"
DEFRA_eaten_out_data$FAO[DEFRA_eaten_out_data$EO.Major.code == "White fish"]<- "Demersal"
DEFRA_eaten_out_data$FAO[DEFRA_eaten_out_data$EO.Major.code == "Shellfish - without sauce or dressing (e.g. prawns, shrimps, oysters, crab)"]<- "Shellfish"
DEFRA_eaten_out_data$FAO[DEFRA_eaten_out_data$EO.Major.code == "Fatty fish"] <-"Pelagic"
DEFRA_eaten_out_data$FAO[DEFRA_eaten_out_data$EO.Major.code == "Kippers and other smoked fish (e.g. smoked salmon)"]<- "Pelagic"

```


```{r Add units and data source}
# Units in g/person/week

```

  
### B)  Kantar

## UK population data

Load UK population data- need to convert per g/ capita data to g/ UK total population.

```{r Load data}

# A) UK population data
# Data source: Office of National Statistics 

# Extract UK population data between 2009 and 2022. 

# Read in population data. 
UK_population_data<- read.csv("NationalStatistics.UK_population_edit.csv")
str(UK_population_data)

# Subset UK population data from 2009 onwards
UK_population<-subset(UK_population_data, 
                      CDID > 2008, select= c(CDID, UKPOP))

```


