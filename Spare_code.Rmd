---
title: "Spare_code"
author: "AL"
date: "2023-02-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### A) Capture fisheries (Marine Management Organisation). Landings into the UK by UK vessels

```{r Load data (2017 to 2018)}
# i) Landings into the UK by UK vessels: 2017 to 2021
# Read in .csv file
df_UK_landings_201721_data <- vroom(file=paste(filepath,"MMO_UK_landings-201721.csv", sep="/"))

# Check for missing values. Right column summed to be total number of rows in the data set
md.pattern(df_UK_landings_201721_data, rotate.names = TRUE)

# Select desired variables and years (2017 to 2018)
df_UK_landings_201718_data <- df_UK_landings_201721_data[c("SpeciesType","Species", "2017", "2018")]
```


```{r Transform data set (2017 to 2018)}
# Change structure of the data set 
df_UK_landings_201718_long <- melt(df_UK_landings_201718_data, id.vars = c( "Species"), variable.name = "Year", value.name = "Value")
```


```{r Load data (2012 to 2016)}
# ii) Landings into the UK by UK vessels: 2012 to 2016 
# Read in .csv file
df_UK_landings_201216_data <- vroom(file=paste(filepath,"NS_UK_landings-201216.csv", sep="/"))

# Check for missing values
md.pattern(df_UK_landings_201216_data, rotate.names = TRUE)

```


```{r Transform data set (2012 to 2016)}
# Change structure of the data set 
df_UK_landings_201216_long <- melt(df_UK_landings_201216_data, id.vars = c("SpeciesType", "Species"), variable.name = "Year", value.name = "Value")
```


```{r Load data (2009 to 2011)}
# iii) Landings into the UK by UK vessels: 2008 to 2012 but select years 2009 to 2011. Always best to use the most recent data set.
# Read in .csv file
df_UK_landings_200812_data <- vroom(file=paste(filepath,"NS_UK_landings-200812.csv", sep="/"))

# Check for missing values
md.pattern(df_UK_landings_200812_data, rotate.names = TRUE)

# Check column names 
colnames(df_UK_landings_200812_data)

# Select desired variables and years (2009 to 2011)
df_UK_landings_200911_data <- df_UK_landings_200812_data[c("SpeciesType","Species", "2009", "2010","2011")]

```


```{r Transform data set (2009 to 2011)}
# Change structure of the data set 
df_UK_landings_200911_long <- melt(df_UK_landings_200911_data, id.vars = c( "Species"), variable.name="Year", value.name="Value")

```


```{r Combine data sets: i) 2009 to 2011; ii) 2012 to 2016; and iii) 2017 to 2018)}
# Combine capture production data i) 2009 to 2011; ii) 2012 to 2016; and iii) 2017 to 2018)
df_UK_landings_200918 <- rbind(df_UK_landings_200911_long,
                              df_UK_landings_201216_long, 
                              df_UK_landings_201718_long)
```


Capture fisheries data are now all in one data frame. Data frame is composed of four columns: SpeciesType, Species, Year and Value. 

We need to ensure species are spelled the same across all data sets, otherwise data sets cannot be merged, for instance "Blue whiting" v.s. "Blue Whiting or "Crab" v.s. "Crabs". We created an excel document listing the unique spellings of all species in all data sets used. In the cleaning process, the data sheets are joined to the "translation" document by the unique species name. In the final cleaned version, the correct species name column is selected. The translation document also provides various species type classifications as per published peer-reviewed papers.


```{r Join data frame with translation document- ensures consistent spelling across data sets}
# Duplicate species name column (allows us to check species have been renames correctly)
df_UK_landings_200918$SpeciesNEW <- df_UK_landings_200918$Species

# Join data frame with MCS data frame by species name
df_UK_landings_200918 <- df_UK_landings_200918 %>% inner_join(., MCS_translations, by = c('SpeciesNEW' = 'MCS (DO NOT TOUCH)'))
# MSC (DO NOT TOUCH) column is the unique spelling of the species in all data sets.

# Check column names of the updated data frame
colnames(df_UK_landings_200918)

```



Landings provided as whole weight. Need to apply conversion factors estimate edible portion of the seafood. Converstion factors taken from Lofstedt et al 2021. 

```{r Apply conversion factors to calculate edible portion of seafood}
# Classify species as finfish or shellfish. New column for conversion name
unique(df_UK_landings_200918$FAO_ST)

# Specify shellfish
df_UK_landings_200918$CN[df_UK_landings_200918$FAO_ST %in% c("Crustaceans", "Molluscs", "Cephalopods", "Other molluscs and aquatic invertebrates", "Other shellfish")] <- "Shellfish"

# Specify finfish
df_UK_landings_200918$CN[df_UK_landings_200918$FAO_ST %in% c("Freshwater fish", "Demersal fish", "Other marine fish", "Pelagic fish")] <- "Finfish"

# Create a new column stating the conversion factor. Conversion factors used to convert whole fish weight to edible weight
# Average conversion factors for finfish: 0.49; shellfish: 0.28 (Lofstedt et al., 2021)

# State average CF finfish: 0.49; shellfish: 0.28 
df_UK_landings_200918$CF[df_UK_landings_200918$CN == "Shellfish"] <- 0.28
df_UK_landings_200918$CF[df_UK_landings_200918$CN == "Finfish"] <- 0.49

# Create new column and apply conversion factors values
df_UK_landings_200918$CFValue <- df_UK_landings_200918$Value * df_UK_landings_200918$CF

```


```{r Convert from 1000 tonnes to grams}
# Convert raw value from 000's tonnes to grams 
df_UK_landings_200918$Value <- (df_UK_landings_200918$CFValue * 1000) * 1000000

```


```{r Add additional variables to data set}
# Create "cleaned" data frame, defining units and data source 
df_UK_landings_200918$Units <- "Grams"
df_UK_landings_200918$DataSupplier <- "MMO"
df_UK_landings_200918$DataSet <- "UK_SeaFisheriesStatistics"
df_UK_landings_200918$Commodity <- "CaptureProduction"
df_UK_landings_200918$Flag <- "ConV1, ConV2"
df_UK_landings_200918$TemporalResolution <- "Annual"

```


```{r Select desired variables for the cleaned data set}
# Identify column names
colnames(df_UK_landings_200918)

# Select desired columns for cleaned data set-- 16  variables
df_UK_landings_200918_cleaned <- df_UK_landings_200918[c("RevisedMCS", "Year", "Value", "Units", "Commodity", "EUMOFA_ST", "FAO_ST", "ISSCAAP_ST", "Golden_2021_ST","Bianchi_2022_ST", "WWF_2022_ST", "SACN", "DataSupplier", "DataSet", "TemporalResolution", "Flag")]

```


```{r Save cleaned data}
# Change file path to "ProcessedData". Can also use setwd()
filepath <- paste(data_dir,"ProcessedData", sep = "")
write.csv(df_UK_landings_200918_cleaned, file = paste(filepath,"UKLandingsinUKOnly_MMO_clean.csv", sep = ""))

```

```{r}
# Classify species as finfish or shellfish. New column for conversion name
#unique(df_UK_AllUKLandings_200918$FAO_ST)

# Specify shellfish
#df_UK_AllUKLandings_200918$CN[df_UK_AllUKLandings_200918$FAO_ST %in% c("Crustaceans", "Molluscs", "Cephalopods", "Other molluscs and aquatic invertebrates", "Other shellfish")] <- "Shellfish"

# Specify finfish
#df_UK_AllUKLandings_200918$CN[df_UK_AllUKLandings_200918$FAO_ST %in% c("Freshwater fish", "Demersal fish", "Other marine fish", "Pelagic fish")] <- "Finfish"

# Create a new column stating the conversion factor. Conversion factors used to convert whole fish weight to edible weight
# Average conversion factors for finfish: 0.49; shellfish: 0.28 (Lofstedt et al., 2021)

# State average CF finfish: 0.49; shellfish: 0.28 
#df_UK_AllUKLandings_200918$CF[df_UK_AllUKLandings_200918$CN == "Shellfish"] <- 0.28
#df_UK_AllUKLandings_200918$CF[df_UK_AllUKLandings_200918$CN == "Finfish"] <- 0.49
```



### C) Capture fisheries (MMO) Landings into the UK and abroad by UK vessels

Clean landings into the UK and abroad by UK vessels data. Data between 2009 and 2018 is obtained from three annual reports. 

```{r Load data (2017 to 2019)}
# i) Landings into the UK by UK and foreign vessels: 2017 to 2021 but select years 2017 to 2018. Always best to use the most recent data set.
# Read in .csv file
df_UKLandingsAndAbroad_201721_data <- vroom(file=paste(filepath,"MMO_UKV_landingUKAbroad-201721.csv", sep="/"), na = c(".."))

# Check for missing values. Right column summed to be total number of rows in the data set
md.pattern(df_UKLandingsAndAbroad_201721_data, rotate.names = TRUE)

# Select desired variables and years (2017 to 2018)
df_UKLandingsAndAbroad_201718_data <- df_UKLandingsAndAbroad_201721_data[c("Species", "2017", "2018")]
```


```{r Transform data set (2017 to 2019)}
# Change structure of the data set 
df_UKLandingsAndAbroad_201718_long <- melt(df_UKLandingsAndAbroad_201718_data, id.vars = c("Species"), variable.name = "Year", value.name = "Value")
```


```{r Load data (2012 to 2016)}
# ii) Landings into the UK by UK and foreign vessels: 2012 to 2016 
# Read in .csv file
df_UKLandingsAndAbroad_201216_data <- vroom(file=paste(filepath,"MMO_UKV_landingUKAbroad-201216.csv", sep="/"), na = c(".."))

# Check for missing values
md.pattern(df_UKLandingsAndAbroad_201216_data, rotate.names = TRUE)

```


```{r Transform data set (2012 to 2016)}
# Change structure of the data set 
df_UKLandingsAndAbroad_201216_long <- melt(df_UKLandingsAndAbroad_201216_data, id.vars = c("Species"), variable.name = "Year", value.name = "Value")
```


```{r Load data (2009 to 2011)}
# iii) Landings into the UK by UK and foreign vessels: 2009 to 2013 but select years 2009 to 2011. Always best to use the most recent data set.
# Read in .csv file
df_UKLandingsAndAbroad_200913_data <- vroom(file=paste(filepath,"MMO_UKV_landingUKAbroad-200913.csv", sep="/"), na = c(".."))

# Check for missing values
md.pattern(df_UKLandingsAndAbroad_200913_data, rotate.names = TRUE)


# Select desired variables and years (2017 to 2019)
df_UKLandingsAndAbroad_200911_data <- df_UKLandingsAndAbroad_200913_data[c("Species", "2009", "2010","2011")]

```


```{r Transform data set (2009 to 2011)}
# Change structure of the data set 
df_UKLandingsAndAbroad_200911_long <- melt(df_UKLandingsAndAbroad_200911_data, id.vars = c("Species"), variable.name="Year", value.name="Value")

```


```{r Combine data sets: i) 2009 to 2011; ii) 2012 to 2016; and iii) 2017 to 2018)}
# Combine capture production data i) 2009 to 2011; ii) 2012 to 2016; and iii) 2017 to 2018)
df_UKLandingsAndAbroad_200918<- rbind(df_UKLandingsAndAbroad_201718_long,
                              df_UKLandingsAndAbroad_201216_long, 
                              df_UKLandingsAndAbroad_200911_long)
```


Capture fisheries data are now all in one data frame. Data frame is composed of three columns: Species, Year and Value (000 tonnes). 

We need to ensure species are spelled the same across all data sets, otherwise data sets cannot be merged, for instance "Blue whiting" v.s. "Blue Whiting or "Crab" v.s. "Crabs". We created an excel document listing the unique spellings of all species in all data sets used. In the cleaning process, the data sheets are joined to the "translation" document by the unique species name. In the final cleaned version, the correct species name column is selected. The translation document also provides various species type classifications as per published peer-reviewed papers.


```{r Join data frame with translation document- ensures consistent spelling across data sets}
# Duplicate species name column (allows us to check species have been renames correctly)
df_UKLandingsAndAbroad_200918$SpeciesNEW <- df_UKLandingsAndAbroad_200918$Species

# Join data frame with MCS data frame by species name
df_UKLandingsAndAbroad_200918 <- df_UKLandingsAndAbroad_200918 %>% inner_join(., MCS_translations, by = c('SpeciesNEW' = 'MCS (DO NOT TOUCH)'))
# MSC (DO NOT TOUCH) column is the unique spelling of the species in all data sets.

# Check column names of the updated data frame
colnames(df_UKLandingsAndAbroad_200918)

```



Landings provided as whole weight. Need to apply conversion factors estimate edible portion of the seafood. Converstion factors taken from Lofstedt et al 2021. 

```{r Apply conversion factors to calculate edible portion of seafood}
# Classify species as finfish or shellfish according to the FAO classification. Create new column for conversion name
unique(df_UKLandingsAndAbroad_200918$FAO_ST)

# Specify shellfish
df_UKLandingsAndAbroad_200918$CN[df_UKLandingsAndAbroad_200918$FAO_ST %in% c("Crustaceans", "Molluscs", "Cephalopods", "Other molluscs and aquatic invertebrates", "Other shellfish")] <- "Shellfish"

# Specify finfish
df_UKLandingsAndAbroad_200918$CN[df_UKLandingsAndAbroad_200918$FAO_ST %in% c("Freshwater fish", "Demersal fish", "Other marine fish", "Pelagic fish")] <- "Finfish"

# Create a new column stating the conversion factor. Conversion factors used to convert whole fish weight to edible weight
# Average conversion factors for finfish: 0.49; shellfish: 0.28 (Lofstedt et al., 2021)

# State average CF finfish: 0.49; shellfish: 0.28 
df_UKLandingsAndAbroad_200918$CF[df_UKLandingsAndAbroad_200918$CN == "Shellfish"] <- 0.28
df_UKLandingsAndAbroad_200918$CF[df_UKLandingsAndAbroad_200918$CN == "Finfish"] <- 0.49

# Create new column and apply conversion factors values
df_UKLandingsAndAbroad_200918$CFValue <- df_UKLandingsAndAbroad_200918$Value * df_UKLandingsAndAbroad_200918$CF

```





```{r Convert from 1000 tonnes to grams}
# Convert raw value from 000's tonnes to grams 
df_UKLandingsAndAbroad_200918$Value <- (df_UKLandingsAndAbroad_200918$CFValue * 1000) * 1000000

```


```{r Add additional variables to data set}
# Create "cleaned" data frame, defining units and data source 
df_UKLandingsAndAbroad_200918$Units <- "Grams"
df_UKLandingsAndAbroad_200918$DataSupplier <- "MMO"
df_UKLandingsAndAbroad_200918$DataSet <- "UK_SeaFisheriesStatistics"
df_UKLandingsAndAbroad_200918$Commodity <- "CaptureProduction"
df_UKLandingsAndAbroad_200918$Flag <- "ConV1, ConV2"
df_UKLandingsAndAbroad_200918$TemporalResolution <- "Annual"

```


```{r Select desired variables for the cleaned data set}
# Identify column names
colnames(df_UKLandingsAndAbroad_200918)

# Select desired columns for cleaned data set-- 16  variables
df_UKLandingsAndAbroad_200918_clean <- df_UKLandingsAndAbroad_200918[c("RevisedMCS", "Year", "Value", "Units", "Commodity", "EUMOFA_ST", "FAO_ST", "ISSCAAP_ST", "Golden_2021_ST","Bianchi_2022_ST", "WWF_2022_ST", "SACN", "DataSupplier", "DataSet", "TemporalResolution", "Flag")]

```


```{r Save cleaned data}
# Change file path to "ProcessedData". Can also use setwd()
filepath <- paste(data_dir,"ProcessedData", sep = "")
write.csv(df_UKLandingsAndAbroad_200918_clean, file = paste(filepath,"LandingsUKAndAbroad_MMO_clean.csv", sep = ""))

```





## END. CODE BELOW NOT NEEDED



# B) Aquaculture production (Marine Scotland and DEFRA)

```{r Load data (Scotland: Marine Scotland Science)}
# a) Aquaculture production in Scotland
# i) salmon, ii) rainbow trout, iii) shellfish
df_MSS_salmon_data <- vroom(file=paste(filepath,"MSS_Scotland_aquacultureSalmon.csv", sep="/"), na = c(".."))

df_MSS_rainbowTrout_data <- vroom(file=paste(filepath,"MSS_Scotland_aquacultureRainbowTrout.csv", sep="/"), na = c(".."))

df_MSS_shellfish_data <- vroom(file=paste(filepath,"MSS_Scotland_aquacultureShellfish.csv", sep="/"), na = c(".."))

```



```{r Subset data (Scotland: Marine Scotland Science)}
# Determine products are for human consumption 
df_MSS_shellfish_HC <- subset(df_MSS_shellfish_data, Production == "For the table")

# Subset data between 2009 and 2021 
df_MSS_salmon <- subset(df_MSS_salmon_data, Year > 2008, 
                        select= c(Year, Tonnes)) 

df_MSS_rainbowTrout <- subset(df_MSS_rainbowTrout_data, Year > 2008, 
                        select= c("Year", "Total Tonnes"))

df_MSS_shellfish <- subset(df_MSS_shellfish_HC, Year > 2008)

# State species, unit and data source
df_MSS_salmon$Units <- "tonnes"
df_MSS_salmon$Species <- "Salmon"
df_MSS_salmon$SpeciesType <- "Diadromous"

df_MSS_rainbowTrout$Units <- "tonnes"
df_MSS_rainbowTrout$Species <- "RainbowTrout"
df_MSS_rainbowTrout$SpeciesType <- "Freshwater"

df_MSS_shellfish$Units <- "Varied"
df_MSS_shellfish$Species <- "Varied"
df_MSS_rainbowTrout$SpeciesType <- "Shellfish"

```

```{r Combine Scottish aqacualture production data}

#df_MMS_production<- merge(df_MSS_salmon, df_MSS_rainbowTrout)

```


```{r Add units and data source (Scotland: Marine Scotland Science)}
# Create "cleaned" data frame, defining units and data source 

#df_clean_UK_landings_09_20$Units <- "tonnes or numbers"
df_MMS_production$DataSupplier <- "Marine_Scotland"
df_MMS_production$DataSet <- "Scottish-aquaculture"
df_MMS_production$Commodity <- "Production"
df_MMS_production$TempRes <- "Annual"
```


### B) Aquaculture production (CEFAS)

```{r Load data (2013 to 2020)}
# UK aquaculture production 
df_CEFAS_UK_aquaculture_data <- vroom(file=paste(filepath,"CEFAS_UK_aquaculture-201320-edit.csv", sep="/"))

# Rename column
names(df_CEFAS_UK_aquaculture_data)[names(df_CEFAS_UK_aquaculture_data)=="Tonnes"] <- "Units"
```

```{r Transform and clean data set (2013 to 2010)}
# Change structure of the data set 
df_UK_aquaculture_201320_long<-melt(df_CEFAS_UK_aquaculture_data, id.vars = c("Type", "Species", "Units"), variable.name="Year", value.name="Value")

```

```{r Allocating fish species corresonding species type (2013 to 2010)}
# Allocate fish species group type 

```

```{r Load data (2009 to 2012)}
# UK aquaculture production 
df_CEFAS_UK_aqaculture_data <- vroom(file=paste(filepath,".csv", sep="/"))

```


```{r Transform and clean data set (2009 to 2012)}
# Change structure of the data set 
df_UK_aquaculture_201320_long<-melt(df_CEFAS_UK_aqaculture_data, id.vars = c("Type", "Species", "Units"), variable.name="Year", value.name="Value")

```

```{r Allocating fish species corresonding species type (2009 to 2012)}
# Allocate fish species group type 

```


```{r Add units and data source (2013 to 2020)}
# Create "cleaned" data frame, defining units and data source 
df_UK_aquaculture_201320_long$DataSupplier <- "CEFAS"
df_UK_aquaculture_201320_long$DataSet <- "Aquaculture"
df_UK_aquaculture_201320_long$Commodity <- "Production"
df_UK_aquaculture_201320_long$TempRes <- "Annual"
```

```{r Save cleaned data (CEFAS 2013 to 2020)}

```

####
```{r}
# Rename column
names(df_UK_landings_11_20_data)[names(df_UK_landings_11_20_data)=="Species_type"] <- "SpeciesType"
```

```{r Load data (2011 to 2020)}
# i) Landings into the UK by UK vessels: 2011 to 2020 (a)

# Read in .csv file
df_UK_landings_11_20_data <- vroom(file=paste(filepath,"NS_UK_landings-201120-edit.csv", sep="/"), na = c(".."))
```


```{r Provide greater granularity in "SpeciesType" column}
# Provide greater granularity to shellfish species
UK_shellfishLandings_11_20 <- subset(df_UK_landings_11_20_data, SpeciesType == "Shellfish") 

# Default "SpeciesType" to "mollusc"
UK_shellfishLandings_11_20$SpeciesType <- "Mollusc"

# Allocate crustaceans 
UK_shellfishLandings_11_20$SpeciesType[UK_shellfishLandings_11_20$Species %in% c("Crabs", "Lobsters", "Nephrops", "Shrimps and Prawns")] <- "Crustacean"

# Allocate cephalopods
UK_shellfishLandings_11_20$SpeciesType[UK_shellfishLandings_11_20$Species %in% c("Cuttlefish", "Squid")] <- "Cephalopod"

# Allocate other shellfish
UK_shellfishLandings_11_20$SpeciesType[UK_shellfishLandings_11_20$Species %in% "Other Shellfish"] <- "Other shellfish"

# Combine with data set 
UK_finfishLandings_11_20 <- df_UK_landings_11_20_data[(df_UK_landings_11_20_data$SpeciesType == "Pelagic") | (df_UK_landings_11_20_data$SpeciesType == "Demersal"),]

df_UK_landings_11_20 <- rbind(UK_finfishLandings_11_20, UK_shellfishLandings_11_20)

```

```{r Transform and clean data set (2011 to 2020)}
# Change structure of the data set 
df_UK_landings_201120_long<-melt(df_UK_landings_11_20, id.vars = c("SpeciesType","Species"), variable.name="Year", value.name="Value")

```


## UK population data (Office of National Statistics)

Download UK population data- need to convert per g/capita data to g/total UK total population.

```{r Load data}
# Read in UK population data 
df_NS_UK_pop_data <- vroom(file=paste(filepath,"NS_UK_population.csv", sep="/"))
```

```{r Subset data}
# Extract UK population data between 2009 onwards
df_UK_pop <- subset(df_NS_UK_pop_data, 
                      CDID > 2008, select= c(CDID, UKPOP))

```

```{r Add units and data source}
# Create "cleaned" data frame, defining units and data source 
df_clean_UK_pop <- df_UK_pop
df_clean_UK_pop$Units <- "UK-total-pop"
df_clean_UK_pop$Data_source <- "National-statistics"
```


```{r Save cleaned data}
# Change file path to "ProcessedData". Can also use setwd()
filepath <- paste(data_dir,"ProcessedData/csv-files", sep="")
filepath <- paste(data_dir,"ProcessedData", sep="")
write.csv(df_clean_UK_pop, file = paste(filepath,"PopSize_NS.csv", sep=""))

```

```{r}
# Changes species one at a time 
str_replace_all(df_UK_landings_09_20$Species, "Blue Whiting", "Blue whiting")
str_replace_all(df_UK_landings_09_20$Species, "Cockles", "Cockle")
str_replace_all(df_UK_landings_09_20$Species, "Crabs", "Crab")
#str_replace_all(df_UK_landings_09_20$Species, "Horse Mackerel", "Horse mackerel")
#str_replace_all(df_UK_landings_09_20$Species, "Lobsters", "Lobster")
#str_replace_all(df_UK_landings_09_20$Species, "Monks or Anglers", "Monk")
#str_replace_all(df_UK_landings_09_20$Species, "Mussels", "Mussel")
#str_replace_all(df_UK_landings_09_20$Species, "Pollack (Lythe)", "Pollock")
#str_replace_all(df_UK_landings_09_20$Species, "Sand Eels", "Sandeel")
#str_replace_all(df_UK_landings_09_20$Species, "Sardines", "Sardine")
#str_replace_all(df_UK_landings_09_20$Species, "Shrimps and Prawns", "Shrimp")
#str_replace_all(df_UK_landings_09_20$Species, "Skates and Rays", "Skate")
#str_replace_all(df_UK_landings_09_20$Species, "Whelks", "Whelk")

#df_UK_landings_09_20$Species == "Pollack (Lythe)"
```


```{r Calculate grams available per capita}

# Add in annual UK population data in a separate column. Duplicate population data for each year. Number of replicates dictated by number of rows in the short and narrow data set.
#df_UK_landings_200920$PopSize<- rep(c(df_clean_UK_pop$UKPOP), each = nrow(df_UK_landings_08_12_data))

# Convert grams/year to g/capita/year
#df_UK_landings_200920$ValueGramsCapitaYear<- #df_UK_landings_200920$ValueGrams/df_UK_landings_200920$PopSize

# Convert grams/year to g/capita/week
#df_UK_landings_200920$ValueGramsCapitaWeek<- df_UK_landings_200920$ValueGramsCapitaYear/52

```


```{r Calculate grams available per capita}
# Add in annual UK population data in a separate column. Duplicate population data for each year. Number of replicates dictated by number of rows in the short and narrow data set.
#df_EUROSTAT_UKFarmed$PopSize<- rep(c(df_clean_UK_pop$UKPOP), each = #nrow(df_EUROSTAT_UK_aquaculture_data))

# Convert raw value from tonnes to grams 
#df_EUROSTAT_UKFarmed$ValueGrams<- (df_EUROSTAT_UKFarmed$CFValue*1000000)

# Convert grams/year to g/capita/year
#df_EUROSTAT_UKFarmed$ValueGramsCapitaYear<- #df_EUROSTAT_UKFarmed$ValueGrams/df_EUROSTAT_UKFarmed$PopSize

# Convert grams/year to g/capita/week
#df_EUROSTAT_UKFarmed$ValueGramsCapitaWeek<- df_EUROSTAT_UKFarmed$ValueGramsCapitaYear/52

```

```{r}
# Number of seafood entries differ per year so need to create a pipe
df_trade_HMRC_data$popSize[df_trade_HMRC_data$Year %in% "2020"] <- 67081000
df_trade_HMRC_data$popSize[df_trade_HMRC_data$Year %in% "2019"] <- 66796800
df_trade_HMRC_data$popSize[df_trade_HMRC_data$Year %in% "2018"] <- 66435600
df_trade_HMRC_data$popSize[df_trade_HMRC_data$Year %in% "2017"] <- 66040200
df_trade_HMRC_data$popSize[df_trade_HMRC_data$Year %in% "2016"] <- 65648100
df_trade_HMRC_data$popSize[df_trade_HMRC_data$Year %in% "2015"] <- 65110000
df_trade_HMRC_data$popSize[df_trade_HMRC_data$Year %in% "2014"] <- 64596800
df_trade_HMRC_data$popSize[df_trade_HMRC_data$Year %in% "2013"] <- 64105700
df_trade_HMRC_data$popSize[df_trade_HMRC_data$Year %in% "2012"] <- 63705000
df_trade_HMRC_data$popSize[df_trade_HMRC_data$Year %in% "2011"] <- 63285100
df_trade_HMRC_data$popSize[df_trade_HMRC_data$Year %in% "2010"] <- 62759500
df_trade_HMRC_data$popSize[df_trade_HMRC_data$Year %in% "2009"] <- 62260500

# Make popsize column numerical value
df_trade_HMRC_data$popSize <- as.numeric(df_trade_HMRC_data$popSize)

# Calculate grams/capita/year
df_trade_HMRC_data$ValueGramsCapitaYear <- df_trade_HMRC_data$ValueGrams/df_trade_HMRC_data$popSize

# Calculate grams/capita/week
df_trade_HMRC_data$ValueGramsCapitaWeek <- df_trade_HMRC_data$ValueGramsCapitaYear/52



# Replace all occurrences of a certain pattern i.e. the species names
df_UK_landings_09_20$SpeciesNEW <- str_replace_all(df_UK_landings_09_20$SpeciesNEW, 
                   c("Blue Whiting" = "Blue whiting", "Cockles" = "Cockle", 
                     "Crabs" = "Crab", "Horse Mackerel" = "Horse mackerel",
                     "Lobsters" = "Lobster", "Lemon sole" = "Sole", 
                     "Monks or Anglers" = "Monks", "Mussels" = "Mussel", 
                     "Pollack (Lythe)" = "Pollock", "Sand Eels" = "Sandeel",
                     "Sardines" = "Sardine", "Shrimps and Prawns" = "Shrimp", 
                     "Skates and Rays" = "Ray", "Whelks" = "Whelk", 
                     "Bass" = "Seabass", "Other Demersal (b)" = "Other demersal",
                     "Other Pelagic" = "Other pelagics", "Scallops" = "Scallop",
                     "Other Shellfish" = "Other shellfish"))


# str_replace_all() does not work with brackets
```


```{r}
# Identify unique SpeciesType entries
#unique(df_UK_landings_200920$SpeciesType)

# Create a new column in the data frame and allocate oily/lean/shellfish classification
#df_UK_landings_200920$SACN[df_UK_landings_200920$SpeciesType == "Crustacean"] <- "Shellfish"
#df_UK_landings_200920$SACN[df_UK_landings_200920$SpeciesType == "Mollusc"] <- "Shellfish"
#df_UK_landings_200920$SACN[df_UK_landings_200920$SpeciesType == "Cephalopod"] <- "Shellfish"
#df_UK_landings_200920$SACN[df_UK_landings_200920$SpeciesType == "OtherShellfish"] <- #"Shellfish"
#df_UK_landings_200920$SACN[df_UK_landings_200920$SpeciesType == "Demersal"] <- "Lean"
#df_UK_landings_200920$SACN[df_UK_landings_200920$SpeciesType == "Pelagic"] <- "Oily"

# No freshwater fish? 
#df_UK_landings_200920$SACN[df_UK_landings_200920$SpeciesType == "Freshwater"] <- "Oily"

```


```{r Allocate SACN values}
# Identify unique SpeciesTypes in the data set
unique(df_trade_HMRC_data$SpeciesType)

# Create a new column for SACN values
df_trade_HMRC_data$SACN[df_trade_HMRC_data$SpeciesType == "Crustacean"] <- "Shellfish"
df_trade_HMRC_data$SACN[df_trade_HMRC_data$SpeciesType == "Mollusc"] <- "Shellfish"
df_trade_HMRC_data$SACN[df_trade_HMRC_data$SpeciesType == "Cephalopod"] <- "Shellfish"
df_trade_HMRC_data$SACN[df_trade_HMRC_data$SpeciesType == "Freshwater"] <- "Oily"
df_trade_HMRC_data$SACN[df_trade_HMRC_data$SpeciesType == "Demersal"] <- "Lean"
df_trade_HMRC_data$SACN[df_trade_HMRC_data$SpeciesType == "Pelagic"] <- "Oily"

# Also state unknowns
df_trade_HMRC_data$SACN[df_trade_HMRC_data$SpeciesType == "OtherFishProducts"] <- "NoData"
df_trade_HMRC_data$SACN[df_trade_HMRC_data$SpeciesType == "Marine fish"] <- "NoData"
df_trade_HMRC_data$SACN[df_trade_HMRC_data$SpeciesType == "Invertebrate"] <- "NoData"


# Replace all occurrences of a certain pattern i.e. the species names
df_trade_HMRC_data$SpeciesNEW <- 
  str_replace_all(df_trade_HMRC_data$SpeciesNEW, 
                   c("Tuna, bluefin" = "Tuna", 
                   "Caviar, livers and roes" = "Other fishProducts"))

# Identify unique species names in trade data  
unique(df_trade_HMRC_data$SpeciesNEW)

```


## Total UK fish consumption (NDNS) OLD

Total fish consumption for the UK by population cohort was downloaded between 2009 and 2019. Below is how the data were cleaned but unlikely to be added to the data base due to a lack of granularity. Data set is reported for every financial year (?).

```{r Load data}
# Read in .csv file
df_NDNS_UK_data <- vroom(file=paste
                      (filepath,"NDNS_UK_consumption-edit.csv", sep="/"))

```


```{r Aggregate cohort information}
# Identify unique age cohorts
unique(df_NDNS_UK_data$`Age category`)

# Create a pipe aggregating sub age cohort totals, irrespective of sex 
NDNS_totals <- df_NDNS_UK_data[df_NDNS_UK_data$`Age category` %in% c("Children 1.5-3 years", "Children 4-10 years", "Children 11-18 years", "Adults 19-64 years", "Adults 65 years and over"), ]

# Sum all consumption data for all years 
df_NDNSSummed <- as.data.frame(apply(NDNS_totals[3:7], 2, sum))

df_NDNSSummed <- as.data.frame(apply(NDNS_totals[c("(2008/09 - 2009/10)", 
"(2010/11 - 2011/12)", "(2012/13 - 2013/14)", "(2014/15-2015/16)",  
"(2016/17-2018/19)")], 2, sum))

df_NDNSSummed <- as.data.frame(colSums(NDNS_totals[c("(2008/09 - 2009/10)", 
"(2010/11 - 2011/12)", "(2012/13 - 2013/14)", "(2014/15-2015/16)",  
"(2016/17-2018/19)")]))

# Rename first column 
df_NDNSSummed<- colnames("Year", "Value")

####

NDNSYears <- c("(2008/09 - 2009/10)", 
"(2010/11 - 2011/12)", "(2012/13 - 2013/14)", "(2014/15-2015/16)",  
"(2016/17-2018/19)")

SumnedNDNS <- as.data.frame(colSums(NDNS_totals[c("(2008/09 - 2009/10)", 
"(2010/11 - 2011/12)", "(2012/13 - 2013/14)", "(2014/15-2015/16)",  
"(2016/17-2018/19)")]))

df_NDNSSummed<- data.frame(NDNS_colnams, SumnedNDNS)


```

```{r Add units and data source}
# Create "cleaned" data frame, defining units and data source 
df_clean_NDNS$DataSupplier <- "NDNS"
df_clean_NDNS$DataSet <- "NDNS"
df_clean_NDNS$Commodity <- "Consumption"
df_clean_NDNS$TempRes <- ""

# SpeciesType, SACN and Species unknown
df_clean_NDNS$SpeciesType <- "Unknown"
df_clean_NDNS$SACN <- "Unknown"
df_clean_NDNS$Species <- "Unknown"
```


```{r Select desired variables for the data set}
dfc_UK_NDNS <- df_clean_NDNS[c("SACN", "SpeciesType", "Year", "ValueGramsCapitaWeek", "DataSupplier", "DataSet", "Commodity", "flag")]

```



AL to check code below to see if needed. Code provides greater granularity to SpeciesType allocation as provided by the Office of National Statistics. 

```{r Provide greater granularity in the SpeciesType column OLD}
# Provide greater granularity in the "SpeciesType" column for shellfish
UK_shellfishLandings_09_20 <- subset(df_UK_landings_09_20, SpeciesType == "Shellfish") 
# Default "SpeciesType" to "Mollusc"
UK_shellfishLandings_09_20$SpeciesType <- "Mollusc"

# Allocate crustaceans 
UK_shellfishLandings_09_20$SpeciesType[UK_shellfishLandings_09_20$SpeciesNEW %in% c("Crab", "Lobster", "Nephrops", "Shrimp")] <- "Crustacean"

# Allocate cephalopods
UK_shellfishLandings_09_20$SpeciesType[UK_shellfishLandings_09_20$SpeciesNEW %in% c("Cuttlefish", "Squid")] <- "Cephalopod"

# Allocate other shellfish
UK_shellfishLandings_09_20$SpeciesType[UK_shellfishLandings_09_20$SpeciesNEW %in% "Other Shellfish"] <- "OtherShellfish"

# Combine with data set 
# Subset finfish landings 
UK_finfishLandings_09_20 <- df_UK_landings_09_20[(df_UK_landings_09_20$SpeciesType == "Pelagic") | (df_UK_landings_09_20$SpeciesType == "Demersal"),]

# Combine shellfish and finfish landings 
df_UK_landings_200920 <- rbind(UK_finfishLandings_09_20, UK_shellfishLandings_09_20)

```


## Delete later

```{r DELETE LATER. Check to see if species columns successfully merge}

# Compare column names 
colnames(df_cleaned_UKFarmed)
colnames(df_cleaned_UK_landings_200920)

# Merge data frames by species name and year
check_names <- merge(df_cleaned_UK_landings_200920, df_cleaned_UKFarmed, 
                     by = c("SpeciesNEW", "Year"))

# Check the species names that overlap between the two data sets
unique(check_names$SpeciesNEW)
unique(df_cleaned_UK_landings_200920$SpeciesNEW)
unique(df_cleaned_UKFarmed$SpeciesNEW)

```



```{r Allocate SpeciesType to food groups}
# Identify unique major food groups descriptions 
#unique(df_DEFRA_household_201618$codeDESCRIPTION)

# Major food codes according to FAO groupings
#df_DEFRA_household_201618$SpeciesType <- "Unknown"
#unique(df_DEFRA_household_201618$SpeciesType)

#df_DEFRA_household_201618$SpeciesType[df_DEFRA_household_201618$codecat %in% c("10201", "10202", "11401")] <- "Demersal"
#df_DEFRA_household_201618$SpeciesType[df_DEFRA_household_201618$codecat %in% c("11702", "11703")] <- "Shellfish"
#df_DEFRA_household_201618$SpeciesType[df_DEFRA_household_201618$codecat %in% c("10601", "10602", "10701", "10702", "10801", "119")]<-"Pelagic"

```

```{r Allocate SACN i.e. lean or oily}
#df_DEFRA_household_201618$SACN[df_DEFRA_household_201618$SpeciesType %in% 
#                                 c("Pelagic")] <- "Oily"
#df_DEFRA_household_201618$SACN[df_DEFRA_household_201618$SpeciesType %in%
#                                 c("Demersal")]<-"Lean"
#df_DEFRA_household_201618$SACN[df_DEFRA_household_201618$SpeciesType %in%
#                                 c("Unknown")]<-"Unknown"
#df_DEFRA_household_201618$SACN[df_DEFRA_household_201618$SpeciesType %in%
#                                 c("Shellfish")]<-"Shellfish"

```


```{r Allocate SpeciesType to food groups}
# Identify unique major food groups descriptions 
#unique(df_DEFRA_eaten_out_201618$codeDESCRIPTION)

# Major food codes according to FAO groupings
#df_DEFRA_eaten_out_201618$SpeciesType <- "Unknown"
#unique(df_DEFRA_eaten_out_201618$codecat)

#df_DEFRA_eaten_out_201618$SpeciesType[df_DEFRA_eaten_out_201618$codecat %in% c("eo120102", "eo120101")] <- "Demersal"
#df_DEFRA_eaten_out_201618$SpeciesType[df_DEFRA_eaten_out_201618$codecat %in% c("eo1203")] <- "Shellfish"
#df_DEFRA_eaten_out_201618$SpeciesType[df_DEFRA_eaten_out_201618$codecat %in% c("eo1204", "eo120202")] <- "Pelagic"

### Trout, tuna and salmon aggregated together 

```


```{r Allocate SACN i.e. lean or oily}
# Identify unique SpeciesTypes
#unique(df_DEFRA_eaten_out_201618$SpeciesType)

# State whether fish are lean or oily
#df_DEFRA_eaten_out_201618$SACN[df_DEFRA_eaten_out_201618$SpeciesType %in% c("Pelagic")] <- "Oily"
#df_DEFRA_eaten_out_201618$SACN[df_DEFRA_eaten_out_201618$SpeciesType %in% c("Demersal")] <- "Lean"
#df_DEFRA_eaten_out_201618$SACN[df_DEFRA_eaten_out_201618$SpeciesType %in% c("Unknown")] <- "Unknown"
#df_DEFRA_eaten_out_201618$SACN[df_DEFRA_eaten_out_201618$SpeciesType %in% c("Shellfish")] <- "Shellfish"

# Note
df_DEFRA_eaten_out_201618$SACN[df_DEFRA_eaten_out_201618$codecat %in% c("eo120201")] <- "Oily" # note: Trout, tuna and salmon aggregated together thus can allocate via SpeciesType

```



```{r Allocate SpeciesType to food group}
# Identify unique major food groups
#unique(df_DEFRA_EO_200915$`EO Major code`)

# Major food codes according to FAO groupings.
#df_DEFRA_EO_200915$SpeciesType <- "Unknown"
#df_DEFRA_EO_200915$SpeciesType[df_DEFRA_EO_200915$`EO Major code` == "White fish"] <- "Demersal"
#df_DEFRA_EO_200915$SpeciesType[df_DEFRA_EO_200915$`EO Major code` == "Shellfish - without sauce or dressing (e.g. prawns, shrimps, oysters, crab)"] <- "Shellfish"
#df_DEFRA_EO_200915$SpeciesType[df_DEFRA_EO_200915$`EO Major code` == "Fatty fish"] <- "Pelagic"
#df_DEFRA_EO_200915$SpeciesType[df_DEFRA_EO_200915$`EO Major code` == "Kippers and other smoked fish (e.g. smoked salmon)"] <- "Pelagic"

# Remove rows where sum is provided 
#df_DEFRA_EO_200915_clean<-df_DEFRA_EO_200915[!grepl("Sum", 
                                         df_DEFRA_EO_200915$`EO Minor code`),]

```


```{r Allocate SACN i.e. lean or oily}
# Identify uniqye SpeciesType in the data set
#unique(df_DEFRA_EO_200915_clean$SpeciesType)

# Allocate oily/lean/shellfish
#df_DEFRA_EO_200915_clean$SACN[df_DEFRA_EO_200915_clean$SpeciesType %in% c("Pelagic")] <- "Oily"
#df_DEFRA_EO_200915_clean$SACN[df_DEFRA_EO_200915_clean$SpeciesType %in% c("Demersal")]<-"Lean"
#df_DEFRA_EO_200915_clean$SACN[df_DEFRA_EO_200915_clean$SpeciesType %in% c("Unknown")]<-"Unknown"
#df_DEFRA_EO_200915_clean$SACN[df_DEFRA_EO_200915_clean$SpeciesType %in% c("Shellfish")]<-"Shellfish"

## Could be useful later
FAO_food_balance_year<-aggregate(list(Amount_1k_t = FAO_food_balance$applied_CF), by= list(Year = FAO_food_balance$Year,  Element = FAO_food_balance$Element), FUN=sum)

```


```{r}
# Note that NDNS is per financial year and is stated as "NDNS year 1"

# Merge population with consumption data 
#df_NDNS_seafoodUKEstimate_Yr1_11 <- merge(df_NDNS_seafoodReported_Yr1_11, UK_population_200918, by = "Year")

# Multiply NDNS total (i.e. reported and non-reporters) by UK population for each year 
#df_NDNS_seafoodUKEstimate_Yr1_11 <- df_NDNS_seafoodUKEstimate_Yr1_11$ /df_NDNS_seafoodUKEstimate_Yr1_11

```


```{r Scale up NDNS consumption data with UK population data}
# Create data frame with NDNS survey year respondents 
#respondersPerYear <- df_NDNS_seafood_consumption_Yr1_11 %>%
    group_by(SurveyYear) %>%
    summarise(Count = n())   

# Merge NDNS responses with consumption data 
#df_NDNS_seafoodReported_Yr1_11 <- merge(df_NDNS_seafood_aggregate_Yr1_11, respondersPerYear, by = "SurveyYear")

# Divide seafood consumption by NDNS respondents 
#df_NDNS_seafoodReported_Yr1_11$avgEaten <- df_NDNS_seafoodReported_Yr1_11$gDay / df_NDNS_seafoodReported_Yr1_11$Count


# Note that NDNS is per financial year and is stated as "NDNS year 1"

# Merge population with consumption data 
#df_NDNS_seafoodUKEstimate_Yr1_11 <- merge(df_NDNS_seafoodReported_Yr1_11, UK_population_200918, by = "Year")

# Multiply NDNS total (i.e. reported and non-reporters) by UK population for each year 
#df_NDNS_seafoodUKEstimate_Yr1_11 <- df_NDNS_seafoodUKEstimate_Yr1_11$ /df_NDNS_seafoodUKEstimate_Yr1_11


```




### Figure 1. Annual UK seafood supply (g/capita/week) between 2009 and 2018

```{r Calculate annual UK seafood supply (g/capita/week) between 2009 and 2018}
# Sum amount of fish available g/capita/week per year for each commodity. 

# Name columns in aggregate function
captProd <- aggregate(list(CaptureProd = df_captureProd_NS_clean_data$Value), 
                      list(Year = df_captureProd_NS_clean_data$Year), sum)
captProd <- subset(captProd, Year < 2019 & Year > 2008) # up to 2018

aquaProd <- aggregate(list(AquaProd = df_aquaProd_Eurostat_clean_data$Value), 
                      list(Year = df_aquaProd_Eurostat_clean_data$Year), sum)
aquaProd <- subset(aquaProd, Year < 2019)# up to 2018

householdPurch <- aggregate(list(HPurch = df_housePurch_DEFRA_data$ValueGramsCapitaWeek), 
                      list(Year = df_housePurch_DEFRA_data$Year), sum)
householdPurch <- subset(householdPurch, Year < 2019) # up to 2018

eatenOutPurch <- aggregate(list(EOPurch = df_eatenOutPurch_DEFRA_data$ValueGramsCapitaWeek), 
                      list(Year = df_eatenOutPurch_DEFRA_data$Year), sum)
eatenOutPurch<- subset(eatenOutPurch, Year < 2019) # up to 2018


# Separate imports and export data
seafoodImports <- subset(df_trade_HMRC_clean_data, Commodity == "Imports")
seafoodExports <- subset(df_trade_HMRC_clean_data, Commodity == "Exports")

imports <- aggregate(list(Imports = seafoodImports$Value), 
                      list(Year = seafoodImports$Year), sum)
imports <- subset(imports, Year < 2019) # up to 2018

exports <- aggregate(list(Exports = seafoodExports$Value), 
                      list(Year = seafoodExports$Year), sum)
exports <- subset(exports, Year < 2019) # up to 2018

```




##### Not needed

## Aggregating the cleaned data sets 

```{r Load data from processed data file}
# State file path 
filepath <- paste(data_dir,"ProcessedData", sep = "")
```


```{r Load cleaned data}
# Load UK capture production data (UK and foreign vessels landings into the UK)
df_allLandingsintoUK_NS_clean_data <- vroom(file = paste(filepath,"AllLandingsintoUK_MMO_PreliminaryCleaned.csv", sep = "/"))

# Load UK aquaculture production data 
df_aquaProd_Eurostat_clean_data <- vroom(file = paste(filepath,"AquacultureData_Eurostat_PreliminaryCleaned.csv", sep = "/"))

# Load UK trade data (further processed)
df_trade_HMRC_clean_data <- vroom(file = paste(filepath,"TradeData_HMRC_PreliminaryCleaned.csv", sep = "/"))

# Load UK household purchasing data 
df_housePurch_DEFRA_clean_data <- vroom(file = paste(filepath,"HouseholdPurchases_DEFRA_PreliminaryCleaned.csv", sep = "/"))

# Load UK eating out purchasing data 
df_eatenOutPurch_DEFRA_clean_data <- vroom(file = paste(filepath,"EatenOutPurchases_DEFRA_PreliminaryCleaned.csv", sep = "/"))

# Load UK consumption data 
df_consumption_NDNS_clean_data <- vroom(file = paste(filepath,"ConsumptionData_NDNS_PreliminaryCleaned.csv", sep = "/"))
```



```{r Check strucure of all data frames}
# Check structure of all data frames prior to combining
colnames(df_allLandingsintoUK_NS_clean_data)
colnames(df_aquaProd_Eurostat_clean_data)
colnames(df_trade_HMRC_clean_data)
colnames(df_eatenOutPurch_DEFRA_clean_data)
colnames(df_housePurch_DEFRA_clean_data)
colnames(df_consumption_NDNS_clean_data)

```


### Creating the Seafood database


```{r Creating the Seafood database}
df_Seafood_DB <- rbind(df_trade_HMRC_clean_data, df_allLandingsintoUK_NS_clean_data) 
df_Seafood_DB <- rbind(df_Seafood_DB, df_aquaProd_Eurostat_clean_data)
df_Seafood_DB <- rbind(df_Seafood_DB,df_consumption_NDNS_clean_data)
df_Seafood_DB <- rbind(df_Seafood_DB,df_eatenOutPurch_DEFRA_clean_data)
df_Seafood_DB <- rbind(df_Seafood_DB,df_housePurch_DEFRA_clean_data)


df_Seafood_CoPu_DB <- rbind(df_consumption_NDNS_clean_data,df_eatenOutPurch_DEFRA_clean_data)
df_Seafood_CoPu_DB <- rbind(df_Seafood_CoPu_DB,df_Househ)

str(df_allLandingsintoUK_NS_clean_data)
```


```{r writing the seafood database}
source("Data_filepath.R")
filepath <- paste(data_dir,"Outputs", sep="")
write.csv(df_Seafood_DB, paste(filepath,"Seafood-database_prelimary.csv",sep="/"), row.names = FALSE)
```



```{r Save cleaned data}
# Change file path to "ProcessedData". Can also use setwd()
filepath <- paste(data_dir,"ProcessedData", sep = "")
write.csv(df_UKSeafoodSuppliesDatabase, file = paste(filepath,"UKSeafoodSupplies_clean.csv", sep = ""))

```



```{r Plot figures side-by-side}
# Ensure y-axis values are on the same scale
# UK
#plot_UKRec <- ggplot(df_UK_supplies_SACN_avg, aes(SACN, Supplies_capWeek)) +
#  geom_col(fill = "#D55E00", color = "black") +
  #scale_x_discrete(guide = guide_axis(angle = 90), name = "") + 
#  scale_y_continuous(name = "Seafood supplies (g/capita/week)", limits = c(0,300)) +
#  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 1.0)

# Scotland 
#plot_ScotRec <- ggplot(df_UK_supplies_SACN_avg, aes(SACN, Supplies_capWeek)) +
#  geom_col(fill = "#D55E00", color = "black") +
  #scale_x_discrete(guide = guide_axis(angle = 90), name = "") + 
#  scale_y_continuous(name = "Seafood supplies (g/capita/week)", limits = c(0,300)) +
#  geom_hline(yintercept = 140, linetype = "dashed", color = "red", linewidth = 1.0)

# Combine plots
#plot_grid(plot_UKRec, plot_ScotRec)
```



```{r Create stacked bar plot for each recommendation}
# Ensure y-axis values are on the same scale
#df_UK_supplies_SACN_avg$loc <- "UK"
#df_Scot_supplies_SACN_avg <- df_UK_supplies_SACN_avg
#df_Scot_supplies_SACN_avg$loc <- "Scotland"
#df_both_supplies_SACN_avg <- rbind(df_Scot_supplies_SACN_avg,df_UK_supplies_SACN_avg)


# Both
#ggplot(df_both_supplies_SACN_avg, aes(y = Supplies_capWeek, x= Type)) +
#  geom_bar(aes(fill = SACN), position = "stack", stat = "identity", fill = cbPalette) +
#  scale_y_continuous(name = "Seafood supplies (g/capita/week)", limits = c(0,300)) +
#  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 1.0) + 
#  facet_wrap(~loc)
# Able to use facetwrap() to change the title of the strip
```


```{r Stack bar chart of seafood types}
# b) Oily, lean and shellfish only
# Subset lean and oily fish only 
#df_UK_SACN_SLO_avg <- subset(df_UK_supplies_SACN_avg, SACN == "Lean" | SACN == "Oily" | SACN == "Shellfish")
#df_UK_SACN_SLO_avg$Type <- "Seafood type"

# Convert variable to factor to specify order
#df_UK_SACN_SLO_avg$SACN <- factor(df_UK_SACN_SLO_avg$SACN, levels = c("Shellfish", "Lean", "Oily"))

# Plot barchat for Scotland
#plot_SLO_Scot <- ggplot(df_UK_SACN_SLO_avg, aes(y = Supplies_capWeek, x= Type, fill = SACN))+
#  geom_bar(position = "stack", stat = "identity", color = "black", fill = c("#D55E00", "#CC79A7", "#999999")) +
##  scale_y_continuous(name = "Seafood supplies (g/capita/week)", limits = c(0,300)) +
#  geom_hline(yintercept = 140, linetype = "dashed", color = "red", linewidth = 1.0) 

#plot_SLO_Scot <- ggplot(df_UK_SACN_SLO_avg, aes(y = Supplies_capWeek, x= Type, fill = SACN))+
#  geom_bar(position = "stack", stat = "identity", color = "black") + 
#  scale_color_brewer(palette = cbPalette) +
#  scale_y_continuous(name = "Seafood supplies (g/capita/week)", limits = c(0,300)) +
#  geom_hline(yintercept = 140, linetype = "dashed", color = "red", linewidth = 1.0) 

# Plot barchat for UK
#plot_SLO_UK <-ggplot(df_UK_SACN_SLO_avg, aes(y = Supplies_capWeek, x= Type, fill = SACN))+
#  geom_bar(position = "stack", stat = "identity", color = "black", fill = c("#D55E00", "#CC79A7", "#999999")) +
#  scale_y_continuous(name = "Seafood supplies (g/capita/week)", limits = c(0,300)) +
#  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 1.0) 

#plot_grid(plot_SLO_Scot, plot_SLO_UK)

```

### Figure 4. Averege UK seafood supplied (g/capita/week), to SACN level between 2009 and 2018.

```{r Compare SACN supplies with dietary recommendations}
# Sum UK seafood supplies per capita by SACN
df_UK_supplies_SACN <- aggregate(Supplies_capWeek ~ SACN + Year, data = df_UK_seafoodDB_capita, sum)
# Average UK seafood supplies per capita for each year
df_UK_supplies_SACN_avg <- aggregate(Supplies_capWeek ~ SACN, data = df_UK_supplies_SACN, mean)

# Create a new varible
df_UK_supplies_SACN_avg$Commodity <- "Species type"

# a) Lean and oily fish only
df_UK_supplies_SACN_avg_LO <- subset(df_UK_supplies_SACN_avg, SACN == "Lean" | SACN == "Oily")

# Plot average seafood supply (g/capita/week), to SACN level (lean and oily) between 2009 and 2018. 
ggplot(df_UK_supplies_SACN_avg_LO, aes(y = Supplies_capWeek, x = Commodity, fill = SACN)) +
  geom_bar(position = "stack", stat = "identity", color = "black", width = 0.5) + 
  scale_y_continuous(name = "Average seafood supplies (g/capita/week)", limits = c(0,300)) +
  scale_x_discrete(name = "") +
  scale_fill_manual(values = c("#CC79A7", "#D55E00"))+
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2.0) +
  geom_hline(yintercept = 140, linetype = "twodash", color = "navyblue", linewidth = 2)

# b) Lean, oily and shellfish
df_UK_supplies_SACN_avg_LOS <- subset(df_UK_supplies_SACN_avg, SACN == "Lean" | SACN == "Oily" | 
                                       SACN == "Shellfish")

# Convert variable to factor to specify order
df_UK_supplies_SACN_avg_LOS$SACN <- factor(df_UK_supplies_SACN_avg_LOS$SACN, levels = c("Shellfish", "Lean", "Oily"))

# Plot average seafood supply (g/capita/week), to SACN level (lean, oily and shellfish) between 2009 and 2018. 
ggplot(df_UK_supplies_SACN_avg_LOS, aes(y = Supplies_capWeek, x = Commodity, fill = SACN)) +
  geom_bar(position = "stack", stat = "identity", color = "black", width = 0.5) + 
  scale_y_continuous(name = "", limits = c(0,300)) +
  scale_x_discrete(name = "")+
  scale_fill_manual(values = c("#999999","#CC79A7", "#D55E00"))+
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2.0) +
  geom_hline(yintercept = 140, linetype = "twodash", color = "navyblue", linewidth = 2)


```






### Figure 4. UK seafood variabilty (g/capita/week) betwen 2008 and 2019

```{r UK seafood variabilty}
# Boxplot of seafood supplies (g/capita/week)
ggplot(df_UK_seafoodDB_capita, aes(Species, Supplies_capWeek)) +
  geom_boxplot() +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") + 
  scale_y_continuous(name = "Seafood supplies (g/capita/week)") +
  geom_hline(yintercept = 0, linetype="dashed", color = "orange", linewidth = 1.0)


# Boxplot of seafood supplies (g)
ggplot(df_UK_seafoodDB_capita, aes(Species, Supplies)) +
  geom_boxplot() +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") + 
  scale_y_continuous(name = "Seafood supplies (g)") +
  geom_hline(yintercept = 0, linetype="dashed", color = "orange", linewidth = 1.0)

# Set y axis scale to logarithmic. Allows us to explore the values aggregated at 0 and those at significantly higher values
ggplot(df_UK_seafoodDB_capita, aes(Species, Supplies)) +
  geom_boxplot() +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") + 
  scale_y_continuous(name = "Seafood supplies (g)") +
  geom_hline(yintercept = 0, linetype="dashed", color = "orange", linewidth = 1.0) +
  scale_y_log10(breaks = c(seq(1,9,1), seq(10,90,10), seq(100,900,100), seq(1000,10000,1000)),
                labels = c("1","","","","","","","","","10" ,"","","","","","","","","100"
                           ,"","","","","","","","","1000" ,"","","","","","","","","10000")) +
  theme(panel.gird.minor = element_blank())

```




#####################
Nutrients of interest: protein_g, totalPUFA_g, vitaminA_µg, vitaminD_µg, vitaminB12_µg, zinc_mg, iron_mg, calcium_mg, selenium_µg, iodine_µg.

```{r Mutiply each production volume to nutrient value}
df_seafood_compDB$ProteinProd_g <- df_seafood_compDB$Production * df_seafood_compDB$Protein_g
df_seafood_compDB$TotalPUFAProd_g <- df_seafood_compDB$Production * df_seafood_compDB$TotalPUFA_g
df_seafood_compDB$VitAProd_g <- df_seafood_compDB$Production * df_seafood_compDB$VitaminA_µg
df_seafood_compDB$VitDProd_g <- df_seafood_compDB$Production * df_seafood_compDB$VitaminD_µg
df_seafood_compDB$VitB12Prod_g <- df_seafood_compDB$Production * df_seafood_compDB$VitaminB12_µg
df_seafood_compDB$ZincProd_g <- df_seafood_compDB$Production * df_seafood_compDB$Zinc_mg
df_seafood_compDB$IronProd_g <- df_seafood_compDB$Production * df_seafood_compDB$Iron_mg
df_seafood_compDB$CalciumProd_g <- df_seafood_compDB$Production * df_seafood_compDB$Calcium_mg
df_seafood_compDB$SeleniumProd_g <- df_seafood_compDB$Production * df_seafood_compDB$Selenium_µg
df_seafood_compDB$IodineProd_g <- df_seafood_compDB$Production * df_seafood_compDB$Iodine_µg

```


```{r Mutiply each production volume to nutrient value}
df_seafood_compDB$ProteinImports_g <- df_seafood_compDB$Imports * df_seafood_compDB$Protein_g
df_seafood_compDB$TotalPUFAImports_g <- df_seafood_compDB$Imports * df_seafood_compDB$TotalPUFA_g
df_seafood_compDB$VitAImports_g <- df_seafood_compDB$Imports * df_seafood_compDB$VitaminA_µg
df_seafood_compDB$VitDImports_g <- df_seafood_compDB$Imports * df_seafood_compDB$VitaminD_µg
df_seafood_compDB$VitB12Imports_g <- df_seafood_compDB$Imports * df_seafood_compDB$VitaminB12_µg
df_seafood_compDB$ZincImports_g <- df_seafood_compDB$Imports * df_seafood_compDB$Zinc_mg
df_seafood_compDB$IronImports_g <- df_seafood_compDB$Imports * df_seafood_compDB$Iron_mg
df_seafood_compDB$CalciumImports_g <- df_seafood_compDB$Imports * df_seafood_compDB$Calcium_mg
df_seafood_compDB$SeleniumImports_g <- df_seafood_compDB$Imports * df_seafood_compDB$Selenium_µg
df_seafood_compDB$IodineImports_g <- df_seafood_compDB$Imports * df_seafood_compDB$Iodine_µg

```


```{r Mutiply each export volume to nutrient value}
df_seafood_compDB$ProteinExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$Protein_g
df_seafood_compDB$TotalPUFAExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$TotalPUFA_g
df_seafood_compDB$VitAExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$VitaminA_µg
df_seafood_compDB$VitDExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$VitaminD_µg
df_seafood_compDB$VitB12Exports_g <- df_seafood_compDB$Exports * df_seafood_compDB$VitaminB12_µg
df_seafood_compDB$ZincExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$Zinc_mg
df_seafood_compDB$IronExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$Iron_mg
df_seafood_compDB$CalciumExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$Calcium_mg
df_seafood_compDB$SeleniumExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$Selenium_µg
df_seafood_compDB$IodineExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$Iodine_µg

```



```{r Calculate nutrient supplies each export volume to nutrient value}
df_seafood_compDB$ProteinSupplies_g <- (df_seafood_compDB$ProteinProd_g +
                                          df_seafood_compDB$ProteinImports_g) - df_seafood_compDB$ProteinExports_g

df_seafood_compDB$TotalPUFASupplies_g <- (df_seafood_compDB$TotalPUFAProd_g +
                                          df_seafood_compDB$TotalPUFAImports_g) - df_seafood_compDB$TotalPUFAExports_g

df_seafood_compDB$VitASupplies_g <- (df_seafood_compDB$VitAProd_g +
                                          df_seafood_compDB$VitAImports_g) - df_seafood_compDB$VitAExports_g

df_seafood_compDB$VitDSupplies_g <- (df_seafood_compDB$VitDProd_g +
                                          df_seafood_compDB$VitDImports_g) - df_seafood_compDB$VitDExports_g

df_seafood_compDB$VitB12Supplies_g <- (df_seafood_compDB$VitB12Prod_g +
                                          df_seafood_compDB$VitB12Imports_g) - df_seafood_compDB$VitB12Exports_g

df_seafood_compDB$ZincSupplies_g <- (df_seafood_compDB$ZincProd_g +
                                          df_seafood_compDB$ZincImports_g) - df_seafood_compDB$ZincExports_g

df_seafood_compDB$IronSupplies_g <- (df_seafood_compDB$IronProd_g +
                                          df_seafood_compDB$IronImports_g) - df_seafood_compDB$IronExports_g

df_seafood_compDB$CalciumSupplies_g <- (df_seafood_compDB$CalciumProd_g +
                                          df_seafood_compDB$CalciumImports_g) - df_seafood_compDB$CalciumExports_g

df_seafood_compDB$SeleniumSupplies_g <- (df_seafood_compDB$SeleniumProd_g +
                                          df_seafood_compDB$SeleniumImports_g) - df_seafood_compDB$SeleniumExports_g

df_seafood_compDB$IodineSupplies_g <- (df_seafood_compDB$IodineProd_g +
                                          df_seafood_compDB$IodineImports_g) - df_seafood_compDB$IodineExports_g

```



##





```{r Aggregate nutrient supplies}
# Subset 2018 data only
df_seafood_compDB2018 <- subset(df_seafood_compDB, Year == 2018)

# Sum UK protein supplies
df_UK_ProtienSupplies_2018 <- aggregate(ProteinSupplies_g ~ Species, data = df_seafood_compDB2018, sum)

# Plot total seafood supplied and consumed (g/capita/week) between 2009 and 2018. 
ggplot(df_UK_ProtienSupplies_2018, aes(Species, ProteinSupplies_g)) +
  geom_bar(stat= "identity", color = "black") +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") +
  scale_y_continuous(name = "UK seafood protein supplies (g)") +
  theme(legend.title = element_blank()) 

# Sum UK vitamin D supplies
df_UK_VitDSupplies_g_2018 <- aggregate(VitDSupplies_g ~ Species, data = df_seafood_compDB2018, sum)
colnames(df_seafood_compDB2018)

# Plot total seafood supplied and consumed (g/capita/week) between 2009 and 2018. 
ggplot(df_UK_VitDSupplies_g_2018, aes(Species, VitDSupplies_g)) +
  geom_bar(stat= "identity", color = "black") +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") +
  scale_y_continuous(name = "UK seafood vit D supplies (g)") +
  theme(legend.title = element_blank())



# Sum UK vitamin D supplies
df_UK_CaSupplies_g_2018 <- aggregate(VitDSupplies_g ~ Species, data = df_seafood_compDB2018, sum)
colnames(df_seafood_compDB2018)

# Plot total seafood supplied and consumed (g/capita/week) between 2009 and 2018. 
ggplot(df_UK_VitDSupplies_g_2018, aes(Species, VitDSupplies_g)) +
  geom_bar(stat= "identity", color = "black") +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") +
  scale_y_continuous(name = "UK seafood vit D supplies (g)") +
  theme(legend.title = element_blank())


df_seafood_compDB2018$VitDImports_g

```


```{r}
# Subset 2018 data only
df_seafood_CompDB2018 <- subset(df_seafood_CompDB, Year == 2018 & Supplies > 0)

range(df_seafood_CompDB2018$Supplies)

# Calculate all nutrient supplies
df_seafood_CompDB2018$ProteinSupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$Protein_g)/100
df_seafood_CompDB2018$TotalPUFASupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$TotalPUFA_g)/100
df_seafood_CompDB2018$VitASupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$VitaminA_µg)/100
df_seafood_CompDB2018$VitB12Supplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$VitaminB12_µg)/100
df_seafood_CompDB2018$VitDSupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$VitaminD_µg)/100
df_seafood_CompDB2018$ZnSupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$Zinc_mg)/100
df_seafood_CompDB2018$FeSupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$Iron_mg)/100
df_seafood_CompDB2018$CaSupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$Calcium_mg)/100
df_seafood_CompDB2018$SeSupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$Selenium_µg)/100
df_seafood_CompDB2018$ISupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$Iodine_µg)/100

# Aggregate UK protein supplies
df_UK_ProtienSupplies_2018 <- aggregate(ProteinSupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_TotalPUFASupplies_2018 <- aggregate(TotalPUFASupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_VitASupplies_2018 <- aggregate(VitASupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_VitB12Supplies_2018 <- aggregate(VitB12Supplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_VitDSupplies_2018 <- aggregate(VitDSupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_ZnSupplies_2018 <- aggregate(ZnSupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_FeSupplies_2018 <- aggregate(FeSupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_SeSupplies_2018 <- aggregate(SeSupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_ISupplies_2018 <- aggregate(ISupplies ~ Species, data = df_seafood_CompDB2018, sum)


# Plot total seafood supplied and consumed (g/capita/week) between 2009 and 2018. 
ggplot(df_UK_ProtienSupplies_2018, aes(Species, ProteinSupplies)) +
  geom_bar(stat= "identity", color = "black") +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") +
  scale_y_continuous(name = "UK seafood protein supplies (g)") +
  theme(legend.title = element_blank()) 

# Plot total seafood supplied and consumed (g/capita/week) between 2009 and 2018. 
ggplot(df_UK_TotalPUFASupplies_2018, aes(Species, TotalPUFASupplies)) +
  geom_bar(stat= "identity", color = "black") +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") +
  scale_y_continuous(name = "UK seafood total PUFA supplies (g)") +
  theme(legend.title = element_blank()) 

# Plot total seafood supplied and consumed (g/capita/week) between 2009 and 2018. 
ggplot(df_UK_VitASupplies_2018, aes(Species, VitASupplies)) +
  geom_bar(stat= "identity", color = "black") +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") +
  scale_y_continuous(name = "UK seafood vitamin A supplies (µg)") +
  theme(legend.title = element_blank()) 

# Plot total seafood supplied and consumed (g/capita/week) between 2009 and 2018. 
VitB12 <- ggplot(df_UK_VitB12Supplies_2018, aes(x = Species, y = VitB12Supplies)) +
  geom_bar(stat= "identity", color = "black") +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") +
  scale_y_continuous(name = "") 
  # scale_y_continuous(name = "UK seafood vitamin B12 supplies (µg)") +
 # theme(legend.title = element_blank()) 

# Plot total seafood supplied and consumed (g/capita/week) between 2009 and 2018. 
vitD <- ggplot(df_UK_VitDSupplies_2018, aes(x= Species, y = VitDSupplies)) +
  geom_bar(stat= "identity", color = "black") +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") + 
  scale_y_continuous(name = "UK seafood vitamin D supplies (µg)") +
  theme(legend.title = element_blank()) 

library(cowplot)
plot_grid(VitB12, vitD, labels = c("A", "B"))
plot_grid(VitB12, vitD, labels = "AUTO")
```

## Calculate amount of nutrients exported
```{r Mutiply each export volume to nutrient value}
# Production 
df_seafood_compDB$TotalPUFAExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$TotalPUFA_g
df_seafood_compDB$VitDExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$VitaminD_µg

# Imports
df_seafood_compDB$TotalPUFAExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$TotalPUFA_g
df_seafood_compDB$VitDExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$VitaminD_µg

# Exports 
df_seafood_compDB$TotalPUFAExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$TotalPUFA_g
df_seafood_compDB$VitDExports_g <- df_seafood_compDB$Exports * df_seafood_compDB$VitaminD_µg

```




### Figure 5. Plot the top five seafoods that contribute the most to key daily RNIs (omega-3 fatty acids, calcium, iron, vitamin D and zinc) in UK adults. Stacked bar chart for each species

```{r}
# Calculate all nutrient supplies
df_seafood_CompDB2018$ProteinSupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$Protein_g)/100
df_seafood_CompDB2018$TotalPUFASupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$TotalPUFA_g)/100
df_seafood_CompDB2018$VitASupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$VitaminA_µg)/100
df_seafood_CompDB2018$VitB12Supplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$VitaminB12_µg)/100
df_seafood_CompDB2018$VitDSupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$VitaminD_µg)/100
df_seafood_CompDB2018$ZnSupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$Zinc_mg)/100
df_seafood_CompDB2018$FeSupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$Iron_mg)/100
df_seafood_CompDB2018$CaSupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$Calcium_mg)/100
df_seafood_CompDB2018$SeSupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$Selenium_µg)/100
df_seafood_CompDB2018$ISupplies <- (df_seafood_CompDB2018$Supplies * df_seafood_CompDB2018$Iodine_µg)/100

# Aggregate UK protein supplies
df_UK_ProtienSupplies_2018 <- aggregate(ProteinSupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_TotalPUFASupplies_2018 <- aggregate(TotalPUFASupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_VitASupplies_2018 <- aggregate(VitASupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_VitB12Supplies_2018 <- aggregate(VitB12Supplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_VitDSupplies_2018 <- aggregate(VitDSupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_ZnSupplies_2018 <- aggregate(ZnSupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_FeSupplies_2018 <- aggregate(FeSupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_SeSupplies_2018 <- aggregate(SeSupplies ~ Species, data = df_seafood_CompDB2018, sum)
df_UK_ISupplies_2018 <- aggregate(ISupplies ~ Species, data = df_seafood_CompDB2018, sum)



```


### Figure 1. Total UK seafood supplies (g/capita/week) between 2009 and 2018  

```{r Total UK seafood supplies (g/capita/week) between 2009 and 2018}
# Sum annual seafood supplies per capita. 
df_UK_supplies_tot <- aggregate(Supplies_pcw ~ Year, data = df_UK_seafoodDB_PCW, sum)

# Plot total seafood supplies (g/capita/week) between 2009 and 2018. 
ggplot(df_UK_supplies_tot, aes(Year, Supplies_pcw)) +
  geom_bar(stat= "identity", color = "black", fill= "#009E73" ) +
  scale_y_continuous(name = "Total seafood supplies (g/capita/week)", limits = c(0,300)) +
  scale_x_continuous(name = "Year", breaks = seq(2009, 2018, 1)) +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2) +
  #geom_hline(yintercept = 140, linetype = "twodash", color = "navyblue", linewidth = 2) +
  theme(legend.title = element_blank()) 

```




### Figure 1. UK seafood supplies and consumption (g/capita/week), by species, in 2018

```{r Subset seafood database to 2018}
# Select variables 
df_UK_seafoodDB_PCW_simp <- df_UK_seafoodDB_PCW[c("Supplies_pcw", "Consumption_pcw", "Year", "Species", "SpeciesType", "SACN")]

# Sum annual seafood supplies per capita 
df_UK_seafoodCapita_suppCons_2018 <- subset(df_UK_seafoodDB_PCW_simp, Year == "2018")

# Change structure of the data set 
df_UK_seafoodCapita_suppCons_2018_long <- melt(df_UK_seafoodCapita_suppCons_2018, id.vars = c("Year", "Species", "SpeciesType", "SACN"), variable.name = "Commodity", value.name = "Value")

# Aggregate data 
df_UK_suppCons_2018_sum <- aggregate(Value ~ Species + SpeciesType + SACN + Commodity, data = df_UK_seafoodCapita_suppCons_2018_long, sum)

# Omit zero readings
df_UK_suppCons_2018_sum <- na.omit(df_UK_suppCons_2018_sum)

# Plot total seafood supplied and consumed (g/capita/week) between 2009 and 2018. 
ggplot(df_UK_suppCons_2018_sum, aes(Species, Value, fill= Commodity)) +
  geom_bar(position = "dodge", stat= "identity", color = "black") +
  scale_y_continuous(name = "Amount of seafood (g/capita/week)", limits = c(0,35)) +
  scale_x_discrete(guide = guide_axis(angle = 45)) +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2) +
  scale_fill_manual(values = c("#009E73", "#E69F00")) +
  theme(legend.title = element_blank()) +
  theme(legend.position = "none")

```

### Figure 2B. Selected UK seafood supplied and consummed (g/capita/week), to species level in 2018.  

```{r Subset desired seafood species in 2018 only}
# Subset 2018 data only
df_UK_seafoodDB_capita_2018 <- subset(df_UK_seafoodCapita_suppCons, Year == 2018)

# Identify seafood species 
unique(df_UK_seafoodDB_capita$Species)

# Subset specific species of interest
df_UK_SOI_capita_2018 <- subset(df_UK_seafoodDB_capita_2018, Species == "Haddock" | 
                                  Species == "Mackerel" | Species == "Salmon" | Species == "Tuna" | 
                                  Species == "Whiting"| Species == "Shrimp"| Species == "Herring" |
                                  Species == "Halibut"| Species == "Plaice" | Species == "Cockle" | 
                                  Species == "Seabass" | Species == "Blue whiting" | 
                                  Species == "Trout" | Species ==  "Octopus" | Species == "Cod")

# Simplify data set and select desired columns 
df_UK_SOI_capita_2018_specific <- df_UK_SOI_capita_2018[c("Species", "SpeciesType", "SACN", "Consumption_capWeek", "Supplies_capWeek")]

# Change structure of the data set 
df_UK_SOI_capita_2018_short <- melt(df_UK_SOI_capita_2018_specific, id.vars = c("Species", "SpeciesType", "SACN"), variable.name = "Commodity", value.name = "Value")

# Plot total seafood supplied and consumed (g/capita/week) in 2018 
ggplot(df_UK_SOI_capita_2018_short, aes(Species, Value, fill= Commodity)) +
  geom_bar(position = "dodge", stat= "identity", color = "black") +
  scale_y_continuous(name = "Amount of seafood (g/capita/week)", limits = c(0,35)) +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2) +
  scale_fill_manual(values = c("#009E73", "#E69F00")) +
  theme(legend.title = element_blank()) +
  theme(legend.position = "none")


# Same plot but reorder species
ggplot(df_UK_SOI_capita_2018_short, aes(reorder(Species, -Value), Value, fill= Commodity)) +
  geom_bar(position = "dodge", stat= "identity", color = "black") +
  scale_y_continuous(name = "Amount of seafood (g/capita/week)", limits = c(0,35)) +
  scale_x_discrete(guide = guide_axis(angle = 90), name = "") +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2) +
  scale_fill_manual(values = c("#009E73", "#E69F00")) +
  theme(legend.title = element_blank()) +
  theme(legend.position = "none")
  
```




#### Old code
### Figure 5. Species contibutions to RNIs Nutrient supply, by species, in 2018. 

Key nutrients include calcium, iron, vitamin D, vitamin A, vitamin B12, iodine, selenium, omega-3 fatty acids and zinc.

```{r Calculate nutrient contributions to weekly recommended intakes}
# Read in data frame
str(df_all_nutrient_cleaned)

# Select specific variables and nutrients 
df_UK_seafoodDBNC <- df_all_nutrient_cleaned %>%  
  select(SeafoodSpecies, SACN, Nutrient, Volume) %>%
  filter(Nutrient == "TotalPUFA_g100g"| Nutrient == "Calcium_mg100g"| Nutrient == "Iron_mg100g"| 
         Nutrient == "VitaminD_µg100g"| Nutrient == "Zinc_mg100g")

# Calculate nutrient content in 280g of fish
df_UK_seafoodDBNC$Volume_PW <- df_UK_seafoodDBNC$Volume * 2.8
df_UK_seafoodDBNC$Nutrient <- as.character(df_UK_seafoodDBNC$Nutrient)

# Create a data frame of weekly RNIS
df_RNI_week <- data.frame(Nutrient = c("TotalPUFA_g100g", "Calcium_mg100g", "Iron_mg100g", 
                                       "VitaminD_µg100g",  "Zinc_mg100g"),
                       RNI_PW_MAX = c(112, 4900, 82.6, 70, 58.1), 
                       RNI_PW_MIN = c(0, 0, 0, 0, 0))

# Merge nutrient values and recommendations
df_nutrients_recs <- merge(df_UK_seafoodDBNC, df_RNI_week, by = "Nutrient")

# Calculate nutrient contribution 
df_nutrients_recs$nutrient_cont <- (df_nutrients_recs$Volume_PW / df_nutrients_recs$RNI_PW_MAX) * 100

```



```{r Create radar plots}
# Restructure data set (nutrients along the top )
# Need to unstack database to calculate seafood supplied. 
# Change structure of the dataframe- convert to wide and short
df_nutrients_recs_short <- df_nutrients_recs %>%
  select(Nutrient, SeafoodSpecies, nutrient_cont)  %>%
  pivot_wider(names_from = Nutrient, values_from = nutrient_cont) 
  
# Make first column row names
df_nutrients_recs_short<- df_nutrients_recs_short %>% 
  remove_rownames %>% 
  column_to_rownames(var="SeafoodSpecies")

# Advised nutrient intake
# Create data frame of max and min RNI's per week
# Average for males and females
df_max_min <- data.frame(
  TotalPUFA_g100g = c(50, 0), Calcium_mg100g = c(50, 0), Iron_mg100g = c(50, 0),
  VitaminD_µg100g = c(50, 0), Zinc_mg100g = c(50, 0)) ## change made here
rownames(df_max_min) <- c("Max", "Min") # State row names

colnames(df_nutrients_recs_short)


# Combine data frames by row
df_mainFish_NC <- rbind(df_max_min, df_nutrients_recs_short)

# Rename columns 
colnames(df_mainFish_NC) <- c("Total PUFA", "Calcium", "Iron", "VitaminD", "Zinc")

# Exports  
# Plot the data for one fish 
df_salmon <- df_mainFish_NC[c("Max", "Min", "Salmon"),]

# Create the radar charts
radarchart(df_salmon, axistype = 1, # custom polygon
    pcol = rgb(0.3372549, 0.7058824, 0.9137255,0.9) , pfcol = 
      rgb(0.34, 0.71, 0.91, 0.5) , plwd = 4 , 
    cglcol = "grey", cglty = 1, axislabcol="grey", caxislabels = seq(0,100,25), cglwd = 0.8,  #custom the grid
    vlcex = 1.5 #custom labels
    )


# Plot the data for one fish 
df_mackerel <- df_mainFish_NC[c("Max", "Min", "Mackerel"),]

# Create the radar charts
radarchart(df_mackerel, axistype = 1, # custom polygon
    pcol=rgb(0.34, 0.71, 0.91,0.9) , pfcol=rgb(0.34, 0.71, 0.91, 0.5) , plwd=4 , 
    cglcol = "grey", cglty = 1, axislabcol="grey", caxislabels = seq(0,100,25), cglwd = 0.8,  #custom the grid
    vlcex = 1.5 #custom labels
    )

# Plot the data for one fish 
df_herring <- df_mainFish_NC[c("Max", "Min", "Herring"),]

# Create the radar charts
radarchart(df_herring, axistype = 1, # custom polygon
    pcol = rgb(0.34, 0.71, 0.91,0.9) , pfcol = rgb(0.34, 0.71, 0.91, 0.5) , plwd = 4 , 
    cglcol = "grey", cglty = 1, axislabcol="grey", caxislabels = seq(0,100,25), cglwd = 0.8,  #custom the grid
    vlcex = 1.5 #custom labels
    )



# Plot the data for one fish 
df_scallop <- df_mainFish_NC[c("Max", "Min", "Scallop"),]

# Create the radar charts
radarchart(df_scallop, axistype = 1, # custom polygon
    pcol = rgb(0.34, 0.71, 0.91,0.9) , pfcol = rgb(0.34, 0.71, 0.91, 0.5) , plwd = 4 , 
    cglcol = "grey", cglty = 1, axislabcol="grey", caxislabels = seq(0,100,25), cglwd = 0.8,  #custom the grid
    vlcex = 1.5 #custom labels
    )
# Nephrops also in top 5


# Reduce plot margin using par()
# Split the screen in 3 parts
op <- par(mar = c(1, 1, 1, 1))
par(mfrow = c(1,3))
```


```{r Radar chart: top 4 exports Create radar plots}
# Create dataframe 
df_topExports <- df_mainFish_NC[c("Max", "Min", "Scallop", "Herring", "Mackerel", "Salmon"),]

# Color vector
colors_border = c(rgb(0.34, 0.71, 0.91, 0.9), rgb(0.94, 0.89, 0.26, 0.9), 
                  rgb(0.8, 0.47, 0.65, 0.9), rgb(0, 0.62, 0.45, 0.9)) # 0.9 transparency

colors_in = c( rgb(0.34, 0.71, 0.91, 0.5), rgb(0.94, 0.89, 0.26, 0.5) , 
               rgb(0.8, 0.47, 0.65, 0.5), rgb(0, 0.62, 0.45, 0.5)) # 0.5 transparency

width <- c(4,4,4,4)

radarchart(df_topExports, axistype = 1, # custom polygon
    pcol = colors_border , pfcol = colors_in , plwd = 4, plty = 1 , 
    cglcol = "grey", cglty = 1, axislabcol="grey", caxislabels = seq(0,50,10), cglwd = 0.8,  #custom the grid
    vlcex = 1.5 #custom labels
    )

radarchart(df_topExports, axistype = 1, # custom polygon
    pcol = colors_border , plwd = 4 , plty = 1,
    cglcol = "grey", cglty = 1, axislabcol="grey", caxislabels = seq(0,50,10), cglwd = 0.8,  #custom the grid
    vlcex = 1.5 #custom labels
    )

# Add a legend

f <- radarchart(df_topExports, axistype = 1, # custom polygon
    pcol = colors_border , pfcol = colors_in , plwd = 4, plty = 1 , 
    cglcol = "grey", cglty = 1, axislabcol="grey", caxislabels = seq(0,50,12.5), cglwd = 0.8,  #custom the grid
    vlcex = 1.5) #custom labels
   
    
f + legend("topright",legend = rownames(df_topExports[-c(1,2),]), bty = "n", pch = 20 , col=colors_in , 
       text.col = "grey", cex = 1.2, pt.cex = 3)



```


```{r Seafood supplies and consumption between 2009 and 2018}
# Subset desired variables 
df_UK_seafoodDB_PCW_CS <- df_UK_seafoodDB_PCW_short[c("Supply", "Consumption", "Year", "Species", "SACN")]

# Change structure of the data set 
df_UK_seafoodDB_PCW_CS_long <- melt(df_UK_seafoodDB_PCW_CS, id.vars = c("Year", "Species", "SACN"), variable.name = "Commodity", value.name = "Volume")

# Aggregate data 
df_UK_seafoodDB_PCW_CS_sum <- aggregate(Volume ~ Year + Commodity, data = df_UK_seafoodDB_PCW_CS_long, sum)

# Plot total seafood supplied and consumed (g/capita/week) between 2009 and 2018. 
ggplot(df_UK_seafoodDB_PCW_CS_sum, aes(Year, Volume, fill= Commodity)) +
  geom_bar(position = "dodge", stat= "identity", color = "black") +
  scale_y_continuous(name = "Amount of seafood (g/capita/week)", limits = c(0,300)) +
  scale_x_discrete(guide = guide_axis(angle = 45)) +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2) +
  scale_fill_manual(values = c("#009E73", "#E69F00")) + # supplies, consumption, 
  theme(legend.title = element_blank()) +
  theme(legend.position = "none")


# Select desired nutrients
df_UK_NC_NOI <- df_UK_NC_SOI %>%  
  select(Species, TotalPUFA_g100g, Calcium_mg100g, Iron_mg100g, VitaminD_µg100g, Zinc_mg100g) %>%
  group_by(Species) %>%
  filter(row_number()==1)
```


```{r Calculate nutrient density score of each fish species}
# Divide nutrient (grams per 100 grams of food) by the recommended daily allowance (RDA) for that nutrient.

# Then divide calories (per 100 grams of the food) by the reference calorie intake (2,000 calories per day).

# Divide the RDA calculation by the calorie calculation
```


```{r Seafood imports exports consumption and purchases by SACN between 2009 and 2018}
# Plot total seafood supplied, purchases and consumed (g/capita/week) between 2009 and 2018. 
ggplot(df_UK_CPS_SACN_total, aes(Year, Volume, fill= Commodity)) +
  geom_bar(position = "dodge", stat= "identity", color = "black") +
  scale_y_continuous(name = "Amount of seafood (g/capita/week)", limits = c(0,300)) +
  scale_x_continuous(name = "Year", breaks = seq(2009, 2018, 1), 
                     guide = guide_axis(angle = 45)) +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2) +
  scale_fill_manual(values = c("#E69F00", "#0072B2", "#009E73")) + # supplies, consumption, purchases
  theme(legend.title = element_blank()) 
  #theme(legend.position = "none")


# Plot total seafood supplied, purchases and consumed (g/capita/week) between 2009 and 2018. 
ggplot(df_UK_CPS_SACN_total, aes(Year, Volume, fill= Commodity)) +
  geom_bar(position = "dodge", stat= "identity", color = "black") +
  scale_y_continuous(name = "Amount of seafood (g/capita/week)", limits = c(0,300)) +
  scale_x_continuous(name = "Year", breaks = seq(2009, 2018, 1), 
                     guide = guide_axis(angle = 45)) +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2) +
  scale_fill_manual(values = c("#E69F00", "#0072B2", "#009E73")) + # supplies, consumption, purchases
  theme(legend.title = element_blank()) 

ggplot(df_UK_CPS_SACN_total) +
  geom_col_pattern(aes(Year, Volume, pattern_fill = SACNType), pattern = 'stripe', fill = 'white',
                   colour  = 'black') +
  scale_y_continuous(name = "Amount of seafood (g/capita/week)", limits = c(0,300)) +
  scale_x_continuous(name = "Year", breaks = seq(2009, 2018, 1), 
                     guide = guide_axis(angle = 45)) +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2) +
  scale_fill_manual(values = c("#E69F00", "#0072B2", "#009E73")) + # supplies, consumption, purchases
  theme(legend.title = element_blank())
```

```{r}
df_UK_seafoodDBNC <- vroom(file=paste(filepath,"Seafood-database-PCW_composition_preliminary.csv", sep="/"), na = c("NA"))
```


```{r Delete later}

# Aggregate data 
df_UK_seafoodDB_PCW_test <- aggregate(Supply ~ Year + Species, data = df_UK_seafoodDB_PCW_short, sum)
df_UK_seafoodDB_PCW_test18 <- subset(df_UK_seafoodDB_PCW_test, Year == 2018)

ggplot(df_UK_seafoodDB_PCW_test18, aes(Species, Supply)) +
  geom_bar(position = "stack", stat= "identity", color = "black") +
  scale_y_continuous(name = "Amount of seafood (g/capita/week)", limits = c(0,100)) +
  scale_x_discrete(name = "Year", 
                     guide = guide_axis(angle = 45)) +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2) +
  theme(legend.title = element_blank()) 

```



```{r Seafood supplies consumption and purchases by SACN category between 2009 and 2018}
# Aggregate data to include SACN
df_UK_CPS_SACN_total <- aggregate(Volume ~ Year + Commodity + SACN, data = df_UK_seafoodDB_PCW_long, sum)

# Convert commodity to a factor
df_UK_CPS_SACN_total$Commodity_f <-  factor(df_UK_CPS_SACN_total$Commodity, levels = c("Consumption", "Purchases", "Supply"))

# Include species type
ggplot(df_UK_CPS_SACN_total, aes(x = Year, y = Volume, fill = SACN)) +
    geom_bar(position = "stack", stat = "identity") +
    facet_wrap( ~ Commodity_f) + 
  theme(panel.margin = grid::unit(-1.25, "lines")) +
  scale_y_continuous(name = "Amount of seafood (g/capita/week)", limits = c(0,300)) +
  scale_x_continuous(name = "Year", breaks = seq(2009, 2018, 1), 
                     guide = guide_axis(angle = 45)) +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2)

# Convert oily and lean fish as finfish? 

```



```{r Seafood imports exports consumption and purchases between 2009 and 2018}
# Subset desired variables 
df_UK_seafoodDB_PCW_trade <- df_UK_seafoodDB_PCW_short[c("Imports", "Exports", "Consumption", "Purchases", "Year", "Species", "SACN")]

# Change structure of the data set 
df_UK_seafoodDB_PCW_trade_long <- melt(df_UK_seafoodDB_PCW_trade, id.vars = c("Year", "Species", "SACN"), variable.name = "Commodity", value.name = "Volume")

# Aggregate data 
df_UK_CPIE_total <- aggregate(Volume ~ Year + Commodity, data = df_UK_seafoodDB_PCW_trade_long, sum)

# Plot figure. Two option below- low to high or high to low
df_UK_CPIE_total$Commodity_f <-  factor(df_UK_CPIE_total$Commodity, levels = c("Consumption", "Purchases", "Imports", "Exports"))

# Plot total seafood supplied, purchases and consumed (g/capita/week) between 2009 and 2018. 
ggplot(df_UK_CPIE_total, aes(Year, Volume, fill= Commodity_f)) +
  geom_bar(position = "dodge", stat= "identity", color = "black") +
  scale_y_continuous(name = "Amount of seafood (g/capita/week)", limits = c(0,400)) +
  scale_x_continuous(name = "Year", breaks = seq(2009, 2018, 1), 
                     guide = guide_axis(angle = 45)) +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2) +
  scale_fill_manual(values = c("#E69F00", "#0072B2", "#009E73", "#F0E442")) + # supplies, consumption, purchases
  theme(legend.title = element_blank()) 
  #theme(legend.position = "none")
```

```{r Create stacked bar plot of SACN}
# Subset desired variables 
df_UK_seafoodDB_PCW_trade <- df_UK_seafoodDB_PCW_short[c("Consumption", "Purchases", "Supply", "Year", "Species", "SACN")]

# Change structure of the data set 
df_UK_seafoodDB_PCW_trade_long <- melt(df_UK_seafoodDB_PCW_trade, id.vars = c("Year", "Species", "SACN"), variable.name = "Commodity", value.name = "Volume")

# Aggregate data 
df_UK_CPIE_total <- aggregate(Volume ~ Year + Commodity + SACN, data = df_UK_seafoodDB_PCW_trade_long, sum)

# Convert variable to factors
df_UK_CPIE_total$SACN_f <-  factor(df_UK_CPIE_total$SACN, levels = c("Other", "Shellfish", "Lean", "Oily"))
df_UK_CPIE_total$Commodity_f <-  factor(df_UK_CPIE_total$Commodity, levels = c("Consumption", "Purchases", "Supply"))

# Plot SACN type for consumption purchases and supply
ggplot(df_UK_CPIE_total, aes(x = as.numeric(interaction(Commodity_f,Year)), y = Volume, fill = SACN_f)) + 
  geom_bar(stat = "identity", color="black", width = 0.6) +
  scale_y_continuous(name = "Amount of seafood (g/capita/week)", limits = c(0,300)) +
  scale_x_continuous(name = "Year", breaks = c(2, 5, 8, 11, 14, 17, 20, 23, 
                                               26, 29), 
                     labels = c("2009", "2010", "2011", "2012", "2013", 
                                "2014", "2015", "2016", "2017", "2018"), 
                     guide = guide_axis(angle = 45)) + 
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2) +
  scale_fill_manual(values = c("#999999", "#DDCC77",  "#CC79A7","#D55E00"))
  
  
#scale_x_continuous(breaks=c(1.5,3.5,5.5),labels=c("oak","birch","cedar"))

```



```{r Seafood imports exports consumption and purchases by SACN between 2009 and 2018}
# Aggregate data to include SACN
df_UK_CPIE_SACN_total <- aggregate(Volume ~ Year + Commodity + SACN, data = df_UK_seafoodDB_PCW_trade_long, sum)

# Convert commodity to a factor
df_UK_CPIE_SACN_total$Commodity_f <- factor(df_UK_CPIE_SACN_total$Commodity, levels = c("Consumption", "Purchases", "Imports", "Exports"))

df_UK_CPIE_SACN_total$SACN_f <- factor(df_UK_CPIE_SACN_total$SACN, levels = c("Other", "Shellfish", "Lean", "Oily"))


# Include species type
ggplot(df_UK_CPIE_SACN_total, aes(x = Year, y = Volume, fill = SACN_f)) +
    geom_bar(position = "stack", stat = "identity") +
    facet_wrap( ~ Commodity_f) + 
  theme(panel.margin = grid::unit(-1.25, "lines")) +
  scale_y_continuous(name = "Amount of seafood (g/capita/week)", limits = c(0,400)) +
  scale_x_continuous(name = "Year", breaks = seq(2009, 2018, 1), 
                     guide = guide_axis(angle = 45)) +
  scale_fill_manual(values = c("#999999", "#DDCC77",  "#CC79A7","#D55E00")) +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2)
```




```{r UK domestic production and supplies in 2018}
# Subset production commodity 
df_UK_seafoodProductionSupply_PCW <- df_UK_seafoodDB_PCW_short[c("Production", "Supply", "Year", "Species", "SACN")]


# Sum UK seafood production, per SACN
df_UK_seafoodProduction_SACN <- aggregate(Production ~ SACN + Year, data = df_UK_seafoodProductionSupply_PCW, sum)

# Sum UK seafood supply, per SACN
df_UK_seafoodSupply_SACN <- aggregate(Supply ~ SACN + Year, data = df_UK_seafoodProductionSupply_PCW, mean)

# Subset for 2018 only 
df_UK_seafoodProduction_SACN_18 <- subset(df_UK_seafoodProduction_SACN, Year == 2018)

# Select for lean and oily fish only
# Include "other" seafood types e.g. cephalopods and unknowns? 
df_UK_seafoodProduction_LOS_18 <- subset(df_UK_seafoodProduction_SACN_18, SACN == "Lean" | SACN == "Oily" | SACN == "Shellfish")

#df_UK_seafoodProduction_LOSO <- subset(df_UK_seafoodProduction_SACN_18, SACN == "Lean" | SACN == "Oily" | SACN == "Shellfish"   | SACN == "Other" )

# State order of the seafood types
df_UK_seafoodProduction_LOS_18$SACN_f <-  factor(df_UK_seafoodProduction_LOS_18$SACN, levels = c("Shellfish", "Lean", "Oily"))

#df_UK_seafoodProduction_LOSO$SACN_f <-  factor(df_UK_seafoodProduction_LOSO$SACN, levels = c("Other", "Shellfish", 
#                                                                                             "Lean", "Oily"))

# Plot average seafood supply (g/capita/week), to SACN level (lean and oily) between 2009 and 2018. 
ggplot(df_UK_seafoodProduction_LOS_18, aes(y = Production, x = Year, fill = SACN_f)) +
  geom_bar(position = "stack", stat = "identity", color = "black", width = 0.4) + 
  scale_y_continuous(name = "Total seafood production (g/capita/week)") +
  scale_x_continuous(name = "Year", breaks = seq(2009, 2018, 1), 
                     guide = guide_axis(angle = 45)) +
  scale_fill_manual(values = c("#DDCC77",  "#CC79A7","#D55E00")) +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2.0) + 
  theme(legend.title = element_blank())

```


```{r Seafood supplies for 2018 only}
df_UK_seafoodSupplies_PCW <- df_UK_seafoodDB_PCW_short[c("Supply", "Year", "Species", "SACN")]

# Sum UK seafood production, per SACN
df_UK_seafoodSupplies_SACN <- aggregate(Supply ~ SACN + Year, data = df_UK_seafoodSupplies_PCW, sum)

# Subset for 2018 only 
df_UK_seafoodSupplies_SACN_18 <- subset(df_UK_seafoodSupplies_SACN, Year == 2018)

# Select for lean and oily fish only
# Include "other" seafood types e.g. cephalopods and unknowns? 
df_UK_seafoodSupplies_LOS_18 <- subset(df_UK_seafoodSupplies_SACN_18, SACN == "Lean" | SACN == "Oily" | SACN == "Shellfish")

#df_UK_seafoodProduction_LOSO <- subset(df_UK_seafoodProduction_SACN_18, SACN == "Lean" | SACN == "Oily" | SACN == "Shellfish"   | SACN == "Other" )

# State order of the seafood types
df_UK_seafoodSupplies_LOS_18$SACN_f <-  factor(df_UK_seafoodSupplies_LOS_18$SACN, levels = c("Shellfish", "Lean", "Oily"))

#df_UK_seafoodProduction_LOSO$SACN_f <-  factor(df_UK_seafoodProduction_LOSO$SACN, levels = c("Other", "Shellfish", 
#                                                                                             "Lean", "Oily"))

# Plot average seafood supply (g/capita/week), to SACN level (lean and oily) between 2009 and 2018. 
ggplot(df_UK_seafoodSupplies_LOS_18, aes(y = Supply, x = Year, fill = SACN_f)) +
  geom_bar(position = "stack", stat = "identity", color = "black", width = 0.4) + 
  scale_y_continuous(name = "Total seafood production (g/capita/week)") +
  scale_x_continuous(name = "Year", breaks = seq(2009, 2018, 1), 
                     guide = guide_axis(angle = 45)) +
  scale_fill_manual(values = c("#DDCC77",  "#CC79A7","#D55E00")) +
  geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2.0) + 
  theme(legend.title = element_blank())


```


```{r}
# Check structure
str(df_UK_seafoodDB_PCW_short)

# Subset of herring, mackerel and salmon
df_selectedSpecies <- subset(df_UK_seafoodDB_PCW_short, Species == "Herring" | Species == "Mackerel" | Species == "Salmon")

# Sum UK seafood production, imports and exports by species
df_UK_selectedSpecies <- aggregate(Year ~ Exports + Imports + Production + Species, data = df_selectedSpecies, sum)

# Create new column
df_UK_selectedSpecies$Supply <- (df_UK_selectedSpecies$Imports + df_UK_selectedSpecies$Production) - df_UK_selectedSpecies$Exports

# Plot the deficit of each species per year
ggplot(df_UK_selectedSpecies, aes(y = Supply, x = Year, fill = Species)) +
  geom_bar(position = "dodge", stat = "identity", color = "black", width = 0.4) + 
  scale_y_continuous(name = "Finfish deficit of selected species (g/capita/week)") +
  scale_x_continuous(name = "Year", breaks = seq(2009, 2018, 1), 
                     guide = guide_axis(angle = 45)) +
  scale_fill_manual(values = c("#DDCC77", "#CC79A7","#D55E00")) +
  #geom_hline(yintercept = 280, linetype = "dashed", color = "red", linewidth = 2.0) + 
  #theme(legend.title = element_blank())



```




### Figure 5. Nutrients supplied and exported per species in 2018. 

To include calcium, iron, vitamin D, vitamin A, vitamin B12, iodine, selenium, and zinc

```{r Calcualte nutrient supplies and exports in PCW}
# Calculate supplies 
df_UK_seafoodDBNC$Supply <- (df_UK_seafoodDBNC$Production + 
                               df_UK_seafoodDBNC$Imports)- df_UK_seafoodDBNC$Exports

# Divide nutrients by 100g and multiply nutrient content by supplies
df_UK_seafoodDBNC$SupplyPUFA_g <- df_UK_seafoodDBNC$Supply *
  (df_UK_seafoodDBNC$TotalPUFA_g100g/ 100)

df_UK_seafoodDBNC$SupplyVitaminA_ug <- df_UK_seafoodDBNC$Supply *
  (df_UK_seafoodDBNC$VitaminA_µg100g/ 100)

df_UK_seafoodDBNC$SupplyVitaminD_ug <- df_UK_seafoodDBNC$Supply *
  (df_UK_seafoodDBNC$VitaminD_µg100g/ 100)

df_UK_seafoodDBNC$SupplyVitaminB12_ug <- df_UK_seafoodDBNC$Supply *
  (df_UK_seafoodDBNC$VitaminB12_µg100g/ 100)

df_UK_seafoodDBNC$SupplyZinc_mg <- df_UK_seafoodDBNC$Supply * 
  (df_UK_seafoodDBNC$Zinc_mg100g/ 100)

df_UK_seafoodDBNC$SupplyIron_mg <- df_UK_seafoodDBNC$Supply *
  (df_UK_seafoodDBNC$Iron_mg100g/ 100)

df_UK_seafoodDBNC$SupplyCalcium_mg <- df_UK_seafoodDBNC$Supply *
  (df_UK_seafoodDBNC$Calcium_mg100g/ 100)

df_UK_seafoodDBNC$SupplySelenium_ug <- df_UK_seafoodDBNC$Supply * 
  (df_UK_seafoodDBNC$Selenium_µg100g/ 100)

df_UK_seafoodDBNC$SupplyIodine_ug <- df_UK_seafoodDBNC$Supply * 
  (df_UK_seafoodDBNC$Iodine_µg100g/ 100)


# Divide nutrients by 100g and multiply nutrient content by exports
df_UK_seafoodDBNC$ExportsPUFA_g <- df_UK_seafoodDBNC$Exports *
  (df_UK_seafoodDBNC$TotalPUFA_g100g/ 100)

df_UK_seafoodDBNC$ExportsVitaminA_ug <- df_UK_seafoodDBNC$Exports *
  (df_UK_seafoodDBNC$VitaminA_µg100g/ 100)

df_UK_seafoodDBNC$ExportsVitaminD_ug <- df_UK_seafoodDBNC$Exports *
  (df_UK_seafoodDBNC$VitaminD_µg100g/ 100)

df_UK_seafoodDBNC$ExportsVitaminB12_ug <- df_UK_seafoodDBNC$Exports *
  (df_UK_seafoodDBNC$VitaminB12_µg100g/ 100)

df_UK_seafoodDBNC$ExportsZinc_mg <- df_UK_seafoodDBNC$Exports * 
  (df_UK_seafoodDBNC$Zinc_mg100g/ 100)

df_UK_seafoodDBNC$ExportsIron_mg <- df_UK_seafoodDBNC$Exports *
  (df_UK_seafoodDBNC$Iron_mg100g/ 100)

df_UK_seafoodDBNC$ExportsCalcium_mg <- df_UK_seafoodDBNC$Exports *
  (df_UK_seafoodDBNC$Calcium_mg100g/ 100)

df_UK_seafoodDBNC$ExportsSelenium_ug <- df_UK_seafoodDBNC$Exports * 
  (df_UK_seafoodDBNC$Selenium_µg100g/ 100)

df_UK_seafoodDBNC$ExportsIodine_ug <- df_UK_seafoodDBNC$Exports * 
  (df_UK_seafoodDBNC$Iodine_µg100g/ 100)


# Divide nutrient commodities by population size, and 52 to get to g/capita/day
df_UK_seafoodDBNC$SupplyPUFA_gPCW <- (df_UK_seafoodDBNC$SupplyPUFA_g/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$SupplyVitaminA_ugPCW <- (df_UK_seafoodDBNC$SupplyVitaminA_ug/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$SupplyVitaminD_ugPCW <- (df_UK_seafoodDBNC$SupplyVitaminD_ug/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$SupplyVitaminB12_ugPCW <- (df_UK_seafoodDBNC$SupplyVitaminB12_ug/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$SupplyIron_mgPCW <- (df_UK_seafoodDBNC$SupplyIron_mg/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$SupplyCalcium_mgPCW <- (df_UK_seafoodDBNC$SupplyCalcium_mg/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$SupplySelenium_ugPCW <- (df_UK_seafoodDBNC$SupplySelenium_ug/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$SupplyIodine_ugPCW <- (df_UK_seafoodDBNC$SupplyIodine_ug/
                                   df_UK_seafoodDBNC$UKPOP) / 52


# Exports
df_UK_seafoodDBNC$ExportsPUFA_gPCW <- (df_UK_seafoodDBNC$ExportsPUFA_g/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$ExportsVitaminA_ugPCW <- (df_UK_seafoodDBNC$ExportsVitaminA_ug/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$ExportsVitaminD_ugPCW <- (df_UK_seafoodDBNC$ExportsVitaminD_ug/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$ExportsVitaminB12_ugPCW <- (df_UK_seafoodDBNC$ExportsVitaminB12_ug/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$ExportsIron_mgPCW <- (df_UK_seafoodDBNC$ExportsIron_mg/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$ExportsCalcium_mgPCW <- (df_UK_seafoodDBNC$ExportsCalcium_mg/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$ExportsSelenium_ugPCW <- (df_UK_seafoodDBNC$ExportsSelenium_ug/
                                   df_UK_seafoodDBNC$UKPOP) / 52
df_UK_seafoodDBNC$ExportsIodine_ugPCW <- (df_UK_seafoodDBNC$ExportsIodine_ug/
                                   df_UK_seafoodDBNC$UKPOP) / 52



# Convert to same nutrients (mg)
#df_UK_seafoodDBNC$SupplyVitaminA_mgPCW <- df_UK_seafoodDBNC$SupplyVitaminA_ugPCW / 1000
#df_UK_seafoodDBNC$SupplyVitaminD_mgPCW <- df_UK_seafoodDBNC$SupplyVitaminD_ugPCW / 1000
#df_UK_seafoodDBNC$SupplyVitaminB12_mgPCW <- df_UK_seafoodDBNC$SupplyVitaminB12_ugPCW / 1000
#df_UK_seafoodDBNC$SupplySelenium_mgPCW <- df_UK_seafoodDBNC$SupplySelenium_ugPCW / 1000
#df_UK_seafoodDBNC$SupplyIodine_mgPCW <- df_UK_seafoodDBNC$SupplyIodine_ugPCW / 1000


#df_UK_seafoodDBNC$ExportsVitaminA_mgPCW <- df_UK_seafoodDBNC$ExportsVitaminA_ugPCW / 1000
#df_UK_seafoodDBNC$ExportsVitaminD_mgPCW <- df_UK_seafoodDBNC$ExportsVitaminD_ugPCW / 1000
#df_UK_seafoodDBNC$ExportsVitaminB12_mgPCW <- df_UK_seafoodDBNC$ExportsVitaminB12_ugPCW / 1000
#df_UK_seafoodDBNC$ExportsSelenium_mgPCW <- df_UK_seafoodDBNC$ExportsSelenium_ugPCW / 1000
#df_UK_seafoodDBNC$ExportsIodine_mgPCW <- df_UK_seafoodDBNC$ExportsIodine_ugPCW / 1000


# Convert to same nutrients (ug)
df_UK_seafoodDBNC$SupplyPUFA_ugPCW <- df_UK_seafoodDBNC$SupplyPUFA_gPCW * 1000000
df_UK_seafoodDBNC$SupplyIron_ugPCW <- df_UK_seafoodDBNC$SupplyIron_mgPCW * 1000
df_UK_seafoodDBNC$SupplyCalcium_ugPCW <- df_UK_seafoodDBNC$SupplyCalcium_mgPCW * 1000

df_UK_seafoodDBNC$ExportsPUFA_ugPCW <- df_UK_seafoodDBNC$ExportsPUFA_gPCW * 1000000
df_UK_seafoodDBNC$ExportsIron_ugPCW <- df_UK_seafoodDBNC$ExportsIron_mgPCW * 1000
df_UK_seafoodDBNC$ExportsCalcium_ugPCW <- df_UK_seafoodDBNC$ExportsCalcium_mgPCW * 1000


# Subset for 2018 only (most recent)
df_UK_seafoodDBNC_2018 <- subset(df_UK_seafoodDBNC, Year == 2018)
unique(df_UK_seafoodDBNC_2018$Year)

# Subset supply
df_nutrientSupply_ug <- df_UK_seafoodDBNC_2018 %>% select(Species, Year, SACN,
                                                  SupplyPUFA_ugPCW,SupplyVitaminA_ugPCW, 
                                         SupplyVitaminD_ugPCW, SupplyVitaminB12_ugPCW,
                                         SupplyIron_ugPCW, SupplyCalcium_ugPCW,   
                                         SupplySelenium_ugPCW, SupplyIodine_ugPCW)
                                         
# Subset exports
df_nutrientExports_ug <- df_UK_seafoodDBNC_2018 %>% select(Species, Year, SACN,
                                                   ExportsPUFA_ugPCW,ExportsVitaminA_ugPCW,
                                         ExportsVitaminD_ugPCW, ExportsVitaminB12_ugPCW,
                                         ExportsIron_ugPCW, ExportsCalcium_ugPCW,
                                         ExportsSelenium_ugPCW, ExportsIodine_ugPCW)

# Restructure data set
df_nutrientSupply_ug_values <- melt(df_nutrientSupply_ug, id.vars = c("Year", "Species", "SACN"), variable.name = "Nutrient", value.name = "Volume")

df_nutrientExports_ug_values <- melt(df_nutrientExports_ug, id.vars = c("Year", "Species", "SACN"), variable.name = "Nutrient", value.name = "Volume")

df_nutrientSupply_ug_values$Volume_10000 <- df_nutrientSupply_ug_values$Volume * 10000
df_nutrientExports_ug_values$Volume_10000 <- df_nutrientExports_ug_values$Volume * 10000

# Only include nutrients if volume is greater than 0.
df_nutrientSupply_ug_10000<- subset(df_nutrientSupply_ug_values, Volume_10000 > 0)
df_nutrientExports_ug_10000 <- subset(df_nutrientExports_ug_values, Volume_10000 > 0)
```


```{r Calcualte nutrients supplied (capita/week) in 2018}
# Log scale
ggplot(df_nutrientSupply_ug_10000, aes(Species, Volume_10000, fill= Nutrient)) +
  geom_bar(position = "dodge", stat= "identity", color = "black") +
  scale_x_discrete(name = "", guide = guide_axis(angle = 45)) +
  scale_fill_manual(values = c("#AA4499", "#44AA99", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00")) +
  theme(legend.title = element_blank()) +
  facet_grid(.~SACN, scales = "free_x", space = "free_x") +
  scale_y_log10(breaks = c(seq(0.01, 0.09, 0.01), seq(0.1, 0.9, 0.1), seq(1,9,1), seq(10,90,10),
                           seq(100,900,100), seq(1000,9000,1000), seq(10000, 90000, 10000), 
                           seq(100000, 1000000, 100000)), 
                labels = c("0.01","","","","","","","","","0.1","","","","","","","","","1 µg","",
                           "","","","","","","","10 µg","","","","","","","","","100 µg","","","","","",
                           "","","","1 mg","","","","","","","","","10 mg","","","","","","","","",
                           "100 mg","","","","","","","","","1 g")) +
  theme(legend.title = element_blank(), 
        strip.background = element_rect(fill= c("#D55E00","#999999", "#DDCC77", "#CC79A7")))

#theme(legend.position = "none")
# Ask BS about strip.background element color fill- can you include more than one color?
```


```{r Calcualte nutrients exported (capita/week) in 2018}
# Plot amount of nutrients exported (capita/week) in 2018
# Log scale
ggplot(df_nutrientExports_ug_10000, aes(Species, Volume_10000, fill= Nutrient)) +
  geom_bar(position = "dodge", stat= "identity", color = "black") +
  scale_x_discrete(name = "", guide = guide_axis(angle = 45)) +
  scale_fill_manual(values = c("#AA4499", "#44AA99", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00")) +
  theme(legend.title = element_blank()) +
  facet_grid(.~SACN, scales = "free_x", space = "free_x") +
  theme(legend.position = "none", strip.background = element_rect(fill= c("#999999", "#DDCC77", "#CC79A7","#D55E00"))) +
  scale_y_log10(breaks = c(seq(0.01, 0.09, 0.01), seq(0.1, 0.9, 0.1), seq(1,9,1), seq(10,90,10),
                           seq(100,900,100), seq(1000,9000,1000), seq(10000, 90000, 10000), 
                           seq(100000, 1000000, 100000)), 
                labels = c("0.01","","","","","","","","","0.1","","","","","","","","","1 µg","",
                           "","","","","","","","10 µg","","","","","","","","","100 µg","","","","","",
                           "","","","1 mg","","","","","","","","","10 mg","","","","","","","","",
                           "100 mg","","","","","","","","","1 g"))

```


### Additional code added here. Need to calucate the percentage contribution of nutrients to the RNIs


```{r Calculate nutrient contributions to weekly recommended intakes}
# Read in data frame
str(df_all_nutrient_cleaned)

# Select specific variables and nutrients 
df_UK_seafoodDBNC <- df_all_nutrient_cleaned %>%  
  select(SeafoodSpecies, SACN, Nutrient, Volume) %>%
  filter(Nutrient == "TotalPUFA_g100g"| Nutrient == "Calcium_mg100g"| Nutrient == "Iron_mg100g"| 
         Nutrient == "VitaminD_µg100g"| Nutrient == "Zinc_mg100g")

# Calculate nutrient content in 280g of fish
df_UK_seafoodDBNC$Volume_PW <- df_UK_seafoodDBNC$Volume * 2.8
df_UK_seafoodDBNC$Nutrient <- as.character(df_UK_seafoodDBNC$Nutrient)

# Create a data frame of weekly RNIS
df_RNI_week <- data.frame(Nutrient = c("TotalPUFA_g100g", "Calcium_mg100g", "Iron_mg100g", 
                                       "VitaminD_µg100g",  "Zinc_mg100g"),
                       RNI_PW_MAX = c(112, 4900, 82.6, 70, 58.1), 
                       RNI_PW_MIN = c(0, 0, 0, 0, 0))

# Merge nutrient values and recommendations
df_nutrients_recs <- merge(df_UK_seafoodDBNC, df_RNI_week, by = "Nutrient")

# Calculate nutrient contribution 
df_nutrients_recs$nutrient_cont <- (df_nutrients_recs$Volume_PW / df_nutrients_recs$RNI_PW_MAX) * 100

```



```{r Create radar plots}
# Restructure data set (nutrients along the top )
# Need to unstack database to calculate seafood supplied. 
# Change structure of the dataframe- convert to wide and short
df_nutrients_recs_short <- df_nutrients_recs %>%
  select(Nutrient, SeafoodSpecies, nutrient_cont)  %>%
  pivot_wider(names_from = Nutrient, values_from = nutrient_cont) 
  
# Make first column row names
df_nutrients_recs_short<- df_nutrients_recs_short %>% 
  remove_rownames %>% 
  column_to_rownames(var="SeafoodSpecies")


# Average nutrient values for each species type
avg_nutrient_exports <- aggregate(Volume ~ Nutrient + SACN, data = df_nutrientExports_ug_values, mean)

# Subset by fish type 
avg_nutrient_exports_oily <- subset(avg_nutrient_exports, SACN == "Oily")

str(avg_nutrient_exports_oily)

# Plot oily fish exports only
ggplot(avg_nutrient_exports_oily,aes(Nutrient, Volume)) + #select the columns to plot
  geom_bar(position = "dodge", stat= "identity", color = "black", width = 1,
           alpha = 0.5) +   #change alpha to make it more or less visible #insert the values 
  coord_polar() +                                                                       #make it round
  geom_label(aes(label = Per90,fill=stat), size = 2,color = "white", show.legend = FALSE)+     #add a label for the value. Change 'label=Per.90' to 'label=Percentile' to show the percentiles
 scale_fill_manual(values=c("ProteinFats" = "#D70232", #choose colors to fill the pizza parts
                             "Minerals" = "#1A78CF",
                             "Vitamins" = "#FF9300")) +                                                              
  theme_minimal() +                                                                     
  theme(legend.position = "top",
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.y = element_blank(),
        plot.title = element_text(hjust=0.5),
        plot.caption = element_text(hjust=0.5,size=6),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank())

```


