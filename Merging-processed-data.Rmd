---
title: "Merging-processed-data"
author: "A.Lofstedt"
date: "2022-10-31"
output: html_document
---

```{r setup, include=FALSE}
# sets options for entire document in the first chunk
knitr::opts_chunk$set(echo = TRUE)
```


## Part 2: Merging processed data to map UK seafood supply chains 

This R Markdown document (part 2) outlines how the data processed is merged together.


## Preparation

```{r Load libraries, include=FALSE}
# Load packages
library(tidyr)
library(dplyr)
library(vroom) # for loading and transforming data
library(tidyverse)
library(reshape2)

```

```{r Load data, echo=TRUE}
# Loading file path to the data into a value 
source("Data_filepath.R")# Data_filepath.R is listed in .gitignore-file. So, you will need to create that file yourself and provide your respected filepath using "data_dir <- [enter your here]"
```

```{r Specify the desired file path}
filepath <- paste(data_dir,"ProcessedData", sep="") 
# note we are able to change this to another file e.g. saving the output

```


## Merge processed data sheets


```{r Load data}
# Read in UK capture production data 
df_wildProd_NS_data <- vroom(file=paste(filepath,"ProductionData_NS-edit.csv", sep="/"))
str(df_wildProd_NS_data)

# Read in UK aquaculture data 
df_aquaProd_Eurostat_data <- vroom(file=paste(filepath,"AquacultureData_Eurostat.csv", sep="/"))
str(df_aquaProd_Eurostat_data)

# Read in UK trade data 
df_trade_HMRC_data <- vroom(file=paste(filepath,"TradeData_HMRC_Preliminary-Cleaned.csv", sep="/"))
str(df_trade_HMRC_data)

# Read in UK household purchasing data 
df_housePurch_DEFRA_data <- vroom(file=paste(filepath,"HouseholdPurchases_DEFRA_edit.csv", sep="/"))
str(df_housePurch_DEFRA_data)

# Read in UK eating out purchasing data 
df_eatenOutPurch_DEFRA_data <- vroom(file=paste(filepath,"EatenOutPurchases_DEFRA.csv", sep="/"))
str(df_eatenOutPurch_DEFRA_data)

```

```{r Check structure of dataframes}
# See individual column names
colnames(df_wildProd_NS_data)
colnames(df_housePurch_DEFRA_data)
colnames(df_eatenOutPurch_DEFRA_data)

df_aquaProd_Eurostat_data <- rename(df_aquaProd_Eurostat_data, Species= SimplifiedSpecies)

```

```{r Merge data set by column names}
# Merge dataframes
UK_seafood_data <- rbind(df_wildProd_NS_data, df_aquaProd_Eurostat_data, df_housePurch_DEFRA_data, df_eatenOutPurch_DEFRA_data)

str(UK_seafood_data)

```

```{r Plot average lean fish capture production (g/capita/day) between 2009 and 2020}

# Subset lean capture fishery production in the UK
prod_lean <- subset(df_wildProd_NS_data, SACN == "Lean", select = c(Year, ValueGramsCapitaDay))

# Subset lean capture fishery production in the UK
prod_oily <- subset(df_wildProd_NS_data, SACN == "Oily", select = c(Year, ValueGramsCapitaDay))

plot(aggregate(ValueGramsCapitaDay ~ Year, data = df_wildProd_NS_data, mean)) # all fish produced 

# Plot lean fish only 
plot(aggregate(ValueGramsCapitaDay ~ Year, data = prod_lean, mean), ylim= c(0, 0.65), col= "red") + points(aggregate(ValueGramsCapitaDay ~ Year, data = prod_oily, mean), col = "blue")


plot(aggregate(ValueGramsCapitaDay ~ Year, data = prod_oily, mean))

```



```{r UK fish production (capture and aqaucualture data)}
# Plot UK production (merge capture and aquaculture data together 
UK_production_data <- rbind(df_wildProd_NS_data, df_aquaProd_Eurostat_data)

# Calculate fish produced per week 
UK_production_data$ValueGramsCapitaWeek <- UK_production_data$ValueGramsCapitaDay*7

# Plot UK fisheries production data between 2009 and 2020
plot(aggregate(ValueGramsCapitaWeek ~ Year, data = UK_production_data, FUN = sum)) 
```

